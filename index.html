<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ポータル</title>
    <style>
/* システムフォントスタックを使用 */
:root {
    --glass-bg: rgba(255, 255, 255, 0.1);
    --glass-border: rgba(255, 255, 255, 0.2);
    --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.25);
    --text-color: rgba(255, 255, 255, 0.9);
    --text-light: rgba(255, 255, 255, 0.65);
    --primary: #6366f1;
    --danger: #ef4444;
    --warning: #f59e0b;
    --success: #10b981;
    --blur-strength: 10px;
    --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    --bg-gradient-1: #6b46b3;
    --bg-gradient-2: #9959c8;
    --bg-gradient-3: #a76ec8;
    --card-opacity: 0.1;
    --animation-speed: 15s;
    --font-size: medium;
}

[data-theme="dark"] {
    --glass-bg: rgba(0, 0, 0, 0.2);
    --glass-border: rgba(255, 255, 255, 0.1);
    --text-color: rgba(255, 255, 255, 0.9);
    --text-light: rgba(255, 255, 255, 0.65);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
}

body {
    min-height: 100vh;
    overflow: hidden;
    color: var(--text-color);
    font-size: var(--font-size);
}

body.font-small {
    font-size: 0.9rem;
}

body.font-medium {
    font-size: 1rem;
}

body.font-large {
    font-size: 1.2rem;
}

/* グラデーション背景とアニメーション */
.background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
    /* スクリーンショットの雰囲気に合わせた紫系グラデーション */
    background: linear-gradient(43deg, var(--bg-gradient-1) 0%, var(--bg-gradient-2) 46%, var(--bg-gradient-3) 100%);
    background-size: 300% 300%;
    animation: gradient-shift var(--animation-speed) ease infinite;
}

[data-theme="dark"] .background {
    background: linear-gradient(43deg, #121212 0%, #2D3748 46%, #1A202C 100%);
}

@keyframes gradient-shift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* 浮遊する円形エレメント */
.circles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    overflow: hidden;
}

.circles li {
    position: absolute;
    display: block;
    list-style: none;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.18);
    animation: float var(--animation-speed) linear infinite;
    bottom: -150px;
    border-radius: 50%;
}

.circles li:nth-child(1) {
    left: 25%;
    width: 80px;
    height: 80px;
    animation-delay: 0s;
    animation-duration: calc(var(--animation-speed) * 1);
}

.circles li:nth-child(2) {
    left: 10%;
    width: 20px;
    height: 20px;
    animation-delay: 2s;
    animation-duration: calc(var(--animation-speed) * 0.8);
}

.circles li:nth-child(3) {
    left: 70%;
    width: 30px;
    height: 30px;
    animation-delay: 4s;
    animation-duration: calc(var(--animation-speed) * 1.2);
}

.circles li:nth-child(4) {
    left: 40%;
    width: 60px;
    height: 60px;
    animation-delay: 0s;
    animation-duration: calc(var(--animation-speed) * 1.33);
}

.circles li:nth-child(5) {
    left: 65%;
    width: 20px;
    height: 20px;
    animation-delay: 0s;
    animation-duration: calc(var(--animation-speed) * 1);
}

.circles li:nth-child(6) {
    left: 75%;
    width: 110px;
    height: 110px;
    animation-delay: 3s;
    animation-duration: calc(var(--animation-speed) * 1.67);
}

.circles li:nth-child(7) {
    left: 35%;
    width: 150px;
    height: 150px;
    animation-delay: 7s;
    animation-duration: calc(var(--animation-speed) * 2);
}

.circles li:nth-child(8) {
    left: 50%;
    width: 25px;
    height: 25px;
    animation-delay: 15s;
    animation-duration: calc(var(--animation-speed) * 1.47);
}

.circles li:nth-child(9) {
    left: 20%;
    width: 15px;
    height: 15px;
    animation-delay: 2s;
    animation-duration: calc(var(--animation-speed) * 1.07);
}

.circles li:nth-child(10) {
    left: 85%;
    width: 150px;
    height: 150px;
    animation-delay: 0s;
    animation-duration: calc(var(--animation-speed) * 1.87);
}

@keyframes float {
    0% {
        transform: translateY(0) rotate(0deg);
        opacity: 0.8;
        border-radius: 50%;
    }
    100% {
        transform: translateY(-1000px) rotate(720deg);
        opacity: 0;
        border-radius: 50%;
    }
}

/* メインコンテナ */
.container {
    width: 100%;
    height: 100vh;
    display: flex;
    flex-direction: column;
    position: relative;
}

header {
    height: 80px;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    padding: 0.5rem;
}

.header-content {
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    box-shadow: var(--glass-shadow);
    padding: 0.8rem 2rem;
    text-align: center;
    transition: var(--transition);
    transform-style: preserve-3d;
    perspective: 1000px;
}

.header-content:hover {
    transform: translateY(-5px) rotateX(5deg);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
}

h1 {
    font-size: 2rem;
    font-weight: 700;
    background: linear-gradient(to right, #ffffff, #c9c9c9);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: -0.5px;
}

/* ダークモードスイッチ */
.theme-toggle {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 10;
    /* ライトモード時のスタイル */
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(0, 0, 0, 0.3);
    color: rgba(0, 0, 0, 0.8);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    transition: var(--transition);
}

/* テーマ設定ボタン */
.theme-settings-btn {
    position: absolute;
    top: 20px;
    right: 70px;
    z-index: 10;
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(0, 0, 0, 0.3);
    color: rgba(0, 0, 0, 0.8);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    transition: var(--transition);
}

/* ダークモード時のスタイル追加 */
[data-theme="dark"] .theme-toggle,
[data-theme="dark"] .theme-settings-btn {
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: rgba(255, 255, 255, 0.8);
}

.theme-toggle:hover,
.theme-settings-btn:hover {
    transform: rotate(30deg);
}

/* コンテンツエリア */
.content {
    flex: 1;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    max-height: calc(100vh - 80px);
    overflow: hidden;
}

/* 検索とフィルターエリア */
.controls {
    width: 100%;
    max-width: 1400px;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.search-container {
    position: relative;
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
}

.search-input {
    width: 100%;
    padding: 1rem 1rem 1rem 3rem;
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 50px;
    box-shadow: var(--glass-shadow);
    color: var(--text-color);
    font-size: 1rem;
    transition: var(--transition);
}

.search-input:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
}

.search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-light);
}

/* カテゴリーフィルター */
.category-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.category-filters {
    display: flex;
    gap: 0.8rem;
    flex-wrap: wrap;
    justify-content: center;
    flex: 1;
}

.category-filter {
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 50px;
    padding: 0.6rem 1.2rem;
    color: var(--text-light);
    cursor: pointer;
    transition: var(--transition);
    font-size: 0.9rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.category-filter:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}

.category-filter.active {
    background: rgba(99, 102, 241, 0.3);
    border-color: rgba(99, 102, 241, 0.5);
    color: white;
}

.manage-categories-btn {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    transition: var(--transition);
}

.manage-categories-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}

/* グループフィルター */
.group-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.group-dropdown-container {
    position: relative;
    flex: 1;
}

.group-filter {
    width: 100%;
    padding: 0.6rem 1rem;
    padding-right: 2.5rem;
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 50px;
    box-shadow: var(--glass-shadow);
    color: var(--text-color);
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    transition: var(--transition);
    cursor: pointer;
}

.group-filter:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
}

.select-arrow {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-light);
    pointer-events: none;
}

.manage-groups-btn {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    transition: var(--transition);
}

.manage-groups-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}

/* リンクグリッド */
.links-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
    width: 100%;
    max-width: 1400px;
    padding: 0.5rem;
    overflow-y: auto;
    max-height: calc(100vh - 200px);
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
}

.links-grid::-webkit-scrollbar {
    width: 5px;
}

.links-grid::-webkit-scrollbar-track {
    background: transparent;
}

.links-grid::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
}

/* リンクカード */
.link-card {
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    box-shadow: var(--glass-shadow);
    padding: 1rem;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    transition: var(--transition);
    height: 100%;
    transform-style: preserve-3d;
    animation: card-appear 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    opacity: 0;
    transform: translateY(20px) scale(0.95);
    min-height: 180px;
}

.link-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 100%;
    background: linear-gradient(to bottom, rgba(255, 255, 255, 0.1), transparent);
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.link-card:hover {
    transform: translateY(-10px) scale(1.02) rotateX(5deg);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
}

.link-card:hover::before {
    opacity: 1;
}

/* グループ表示バッジ */
.group-badge {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    padding: 0.25rem 0.5rem;
    border-radius: 50px;
    font-size: 0.7rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    z-index: 1;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* 編集モード用スタイル */
.link-card.editable {
    cursor: pointer;
    transition: all 0.3s ease;
}

.link-card.editable:hover {
    box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.5);
}

.link-card.selected {
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.7) !important;
    transform: translateY(-5px) scale(1.02);
}

@keyframes card-appear {
    0% {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.link-icon {
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 0.8rem;
    color: var(--text-color);
    transition: var(--transition);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.link-card:hover .link-icon {
    transform: scale(1.1) rotate(-5deg);
    background: rgba(99, 102, 241, 0.2);
    border-color: rgba(99, 102, 241, 0.3);
}

.link-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.3rem;
    line-height: 1.3;
}

.link-description {
    font-size: 0.85rem;
    font-weight: 300;
    color: var(--text-light);
    margin-bottom: 1rem;
    flex-grow: 1;
    line-height: 1.4;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
}

.link-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
}

.link-actions-group {
    display: flex;
    gap: 0.5rem;
}

.visit-btn {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-color);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50px;
    padding: 0.5rem 1rem;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
}

.visit-btn:hover {
    background: rgba(99, 102, 241, 0.3);
    border-color: rgba(99, 102, 241, 0.5);
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
}

.icon-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
}

.icon-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.delete-btn {
    color: var(--danger);
}

.delete-btn:hover {
    background: rgba(255, 82, 82, 0.2);
    border-color: rgba(255, 82, 82, 0.3);
}

.edit-btn:hover {
    background: rgba(99, 102, 241, 0.2);
    border-color: rgba(99, 102, 241, 0.3);
}

/* 上下移動ボタン用のスタイル */
.position-controls {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.link-card:hover .position-controls {
    opacity: 1;
}

.position-btn {
    width: 24px;
    height: 24px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.position-btn:hover {
    background: rgba(99, 102, 241, 0.2);
    border-color: rgba(99, 102, 241, 0.3);
    transform: scale(1.1);
}

.move-up-btn:hover {
    transform: translateY(-2px) scale(1.1);
}

.move-down-btn:hover {
    transform: translateY(2px) scale(1.1);
}

/* 配置編集モード用のスタイル */
.edit-mode-btn {
    position: fixed;
    bottom: 2rem;
    left: 2rem;
    background: rgba(245, 158, 11, 0.2);
    border: 1px solid rgba(245, 158, 11, 0.3);
}

.edit-mode-btn.active {
    background: rgba(245, 158, 11, 0.4);
    transform: scale(1.1);
}

.edit-mode-banner {
    background: rgba(245, 158, 11, 0.2);
    border: 1px solid rgba(245, 158, 11, 0.3);
    padding: 0.8rem 1rem;
    border-radius: 12px;
    margin-bottom: 1rem;
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    width: 100%;
    max-width: 1400px;
}

.edit-mode-banner-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 500;
}

/* フローティングアクションボタン */
.floating-btn {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 60px;
    height: 60px;
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    background: rgba(99, 102, 241, 0.2);
    border: 1px solid rgba(99, 102, 241, 0.3);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 100;
    transition: var(--transition);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.floating-btn:hover {
    transform: scale(1.1) rotate(5deg);
    background: rgba(99, 102, 241, 0.3);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
}

.floating-btn svg {
    transition: transform 0.3s ease;
}

.floating-btn.active svg {
    transform: rotate(45deg);
}

/* モーダル */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
}

.modal-overlay.active {
    opacity: 1;
    visibility: visible;
}

.modal {
    width: 90%;
    max-width: 500px;
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    box-shadow: var(--glass-shadow);
    padding: 2rem;
    transform: translateY(20px) scale(0.95);
    opacity: 0;
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s;
}

.modal-overlay.active .modal {
    transform: translateY(0) scale(1);
    opacity: 1;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.modal-title {
    font-size: 1.5rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.modal-title-icon {
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-color);
}

.modal-close {
    background: none;
    border: none;
    color: var(--text-light);
    font-size: 1.5rem;
    cursor: pointer;
    transition: color 0.3s;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
}

.modal-close:hover {
    color: white;
    background: rgba(255, 255, 255, 0.1);
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    font-weight: 500;
}

.form-input {
    width: 100%;
    padding: 0.8rem 1rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: var(--text-color);
    font-size: 1rem;
    transition: all 0.3s;
}

.form-input:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
    border-color: rgba(99, 102, 241, 0.5);
    background: rgba(255, 255, 255, 0.15);
}

.form-textarea {
    min-height: 100px;
    resize: none;
}

.form-select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1rem;
    color: var(--text-color);
}

.form-select option {
    background-color: #333;
    color: white;
}

/* カラーピッカー */
.color-picker {
    width: 40px;
    height: 40px;
    padding: 2px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    overflow: hidden;
    cursor: pointer;
    background: transparent;
}

.add-group-input {
    display: flex;
    gap: 0.5rem;
}

.add-group-input .form-input {
    flex: 1;
}

.inline-select {
    width: auto;
    margin-left: 0.5rem;
    padding: 0.3rem 0.5rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    color: var(--text-color);
}

.btn {
    padding: 0.8rem 1.5rem;
    background: rgba(99, 102, 241, 0.3);
    border: 1px solid rgba(99, 102, 241, 0.5);
    border-radius: 50px;
    color: white;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn:hover {
    background: rgba(99, 102, 241, 0.4);
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
}

.btn-block {
    width: 100%;
    justify-content: center;
}

.btn-small {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
}

.btn-outline {
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-primary {
    background: rgba(99, 102, 241, 0.3);
    border: 1px solid rgba(99, 102, 241, 0.5);
}

.btn-danger {
    background: rgba(239, 68, 68, 0.3);
    border: 1px solid rgba(239, 68, 68, 0.5);
}

.btn-danger:hover {
    background: rgba(239, 68, 68, 0.4);
}

.btn-cancel {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* カテゴリー管理 */
.category-list {
    margin-bottom: 1.5rem;
    max-height: 300px;
    overflow-y: auto;
}

.category-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    transition: var(--transition);
}

.category-item:hover {
    background: rgba(255, 255, 255, 0.1);
}

.category-name {
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.category-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
}

.category-actions {
    display: flex;
    gap: 0.5rem;
}

.add-category-group {
    display: flex;
    gap: 0.5rem;
}

/* グループ管理 */
.group-list {
    margin-bottom: 1.5rem;
    max-height: 300px;
    overflow-y: auto;
}

.group-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    transition: var(--transition);
}

.group-item:hover {
    background: rgba(255, 255, 255, 0.1);
}

.group-name {
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.group-color {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    display: inline-block;
}

.group-actions {
    display: flex;
    gap: 0.5rem;
}

/* ローディングアニメーション */
.loading {
    display: flex;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    gap: 0.5rem;
}

.loading span {
    display: inline-block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.7);
    animation: loading 1.5s ease-in-out infinite;
}

.loading span:nth-child(2) {
    animation-delay: 0.15s;
}

.loading span:nth-child(3) {
    animation-delay: 0.3s;
}

@keyframes loading {
    0%, 100% {
        transform: translateY(0);
        opacity: 0.4;
    }
    50% {
        transform: translateY(-10px);
        opacity: 1;
    }
}

/* 空の状態 */
.empty-state {
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    box-shadow: var(--glass-shadow);
    padding: 3rem 2rem;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    width: 100%;
    max-width: 500px;
    margin: 0 auto;
}

.empty-icon {
    width: 80px;
    height: 80px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.empty-title {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.empty-description {
    color: var(--text-light);
    max-width: 300px;
    margin: 0 auto;
}

/* トースト通知 */
.toast {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 50px;
    box-shadow: var(--glass-shadow);
    padding: 0.8rem 1.5rem;
    color: var(--text-color);
    z-index: 2000;
    opacity: 0;
    transition: transform 0.3s, opacity 0.3s;
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.toast.active {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
}

.toast-icon {
    color: #10b981;
}

.toast-message {
    font-weight: 500;
}

/* ツールチップ */
.tooltip {
    position: absolute;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.8rem;
    z-index: 100;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s, transform 0.2s;
    transform: translateY(5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

/* 時計とカレンダーのスタイル */
.clock-container {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
}

.current-time {
  backdrop-filter: blur(var(--blur-strength));
  -webkit-backdrop-filter: blur(var(--blur-strength));
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 50px;
  padding: 0.6rem 1.2rem;
  color: var(--text-color);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 500;
  box-shadow: var(--glass-shadow);
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  animation: fadeIn 0.5s ease-out forwards;
}

.calendar-popup {
  position: absolute;
  top: calc(100% + 10px);
  left: 0;
  width: 300px;
  backdrop-filter: blur(var(--blur-strength));
  -webkit-backdrop-filter: blur(var(--blur-strength));
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  box-shadow: var(--glass-shadow);
  padding: 1rem;
  display: none;
  opacity: 0;
  transform: translateY(10px) scale(0.95);
  transition: opacity 0.3s, transform 0.3s;
  z-index: 1001;
}

/* 日付と時刻を表示するためのスタイル追加 */
.date-time-container {
  display: flex;
  flex-direction: column;
  line-height: 1.2;
}

.date-display {
  font-size: 0.85rem;
  opacity: 0.85;
}

.current-time:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.calendar-popup.active {
  display: block;
  opacity: 1;
  transform: translateY(0) scale(1);
  animation: fadeInUp 0.3s forwards;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.calendar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1rem;
}

#currentMonth {
  font-weight: 600;
  font-size: 1.1rem;
}

.month-nav-btn {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
}

.month-nav-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.1);
}

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
}

.weekday {
  text-align: center;
  font-size: 0.8rem;
  font-weight: 500;
  padding: 0.5rem 0;
  color: var(--text-light);
}

.date {
  text-align: center;
  padding: 0.5rem 0;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s;
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
}

.date:hover {
  background: rgba(255, 255, 255, 0.1);
}

.today {
  background: rgba(99, 102, 241, 0.3);
  font-weight: 700;
}

.other-month {
  color: var(--text-light);
  opacity: 0.5;
}

.weekend {
  color: rgba(239, 68, 68, 0.8);
}

/* テーマ設定スタイル */
.theme-settings-content {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.theme-mode-toggle {
    display: flex;
    gap: 0.5rem;
}

.theme-mode-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: var(--text-color);
    cursor: pointer;
    transition: all 0.2s;
}

.theme-mode-btn:hover {
    background: rgba(255, 255, 255, 0.15);
}

.theme-mode-btn.active {
    background: rgba(99, 102, 241, 0.3);
    border-color: rgba(99, 102, 241, 0.5);
}

.theme-colors {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.color-option {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.color-option label {
    font-size: 0.85rem;
}

.theme-effects {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.effect-option {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.effect-option label {
    flex: 1;
    font-size: 0.85rem;
}

.effect-option span {
    width: 40px;
    text-align: right;
    font-size: 0.85rem;
}

.range-slider {
    flex: 2;
    -webkit-appearance: none;
    appearance: none;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    outline: none;
}

.range-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--primary);
    cursor: pointer;
}

.range-slider::-moz-range-thumb {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--primary);
    cursor: pointer;
    border: none;
}

.theme-presets {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.preset-btn {
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50px;
    color: var(--text-color);
    cursor: pointer;
    transition: all 0.2s;
}

.preset-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    margin-top: 1rem;
}

/* 一括インポートスタイル */
.import-tabs {
    display: flex;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 1.5rem;
}

.import-tab {
    padding: 0.8rem 1.2rem;
    background: transparent;
    border: none;
    color: var(--text-light);
    cursor: pointer;
    position: relative;
    transition: color 0.2s;
}

.import-tab.active {
    color: var(--text-color);
}

.import-tab.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--primary);
}

.import-content {
    display: none;
}

.import-content.active {
    display: block;
}

.import-instructions {
    margin-bottom: 1.5rem;
    font-size: 0.9rem;
    color: var(--text-light);
}

.file-input {
    border: 2px dashed rgba(255, 255, 255, 0.2);
    padding: 1.5rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.file-input:hover {
    border-color: rgba(99, 102, 241, 0.5);
    background: rgba(99, 102, 241, 0.1);
}

.preview-container {
    margin-top: 1rem;
    padding: 1rem;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    max-height: 150px;
    overflow-y: auto;
    font-family: monospace;
    font-size: 0.85rem;
    white-space: pre-wrap;
}

.import-options {
    margin: 1.5rem 0;
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.import-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
}

/* データ転送ボタン */
.data-transfer-buttons {
    position: fixed;
    bottom: 2rem; /* 下部に固定 */
    right: 8rem; /* 右から8rem（+ボタンの左側に配置） */
    display: flex;
    flex-direction: row; /* 横並び */
    gap: 0.5rem;
    z-index: 100;
}

.data-btn {
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    border: 1px solid var(--glass-border);
    border-radius: 50px;
    padding: 0.6rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-color);
    background: var(--glass-bg);
    cursor: pointer;
    transition: var(--transition);
    box-shadow: var(--glass-shadow);
}

.data-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.export-btn {
    background: rgba(16, 185, 129, 0.2); /* 緑色 */
    border: 1px solid rgba(16, 185, 129, 0.3);
}

.export-btn:hover {
    background: rgba(16, 185, 129, 0.3);
}

.import-btn {
    background: rgba(79, 70, 229, 0.2); /* 紫色 */
    border: 1px solid rgba(79, 70, 229, 0.3);
}

.import-btn:hover {
    background: rgba(79, 70, 229, 0.3);
}

.bulk-import-btn {
    background: rgba(245, 158, 11, 0.2); /* オレンジ色 */
    border: 1px solid rgba(245, 158, 11, 0.3);
}

.bulk-import-btn:hover {
    background: rgba(245, 158, 11, 0.3);
}

/* リセットボタン */
.reset-data-btn {
    position: fixed;
    bottom: 2rem;
    left: 6rem; /* editModeBtn の横に配置 */
    background: rgba(239, 68, 68, 0.2);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: white;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 100;
    transition: var(--transition);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.reset-data-btn:hover {
    transform: scale(1.1);
    background: rgba(239, 68, 68, 0.3);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
}

/* レスポンシブ対応 */
@media (max-width: 768px) {
    .category-filters {
        overflow-x: auto;
        justify-content: flex-start;
        padding-bottom: 0.5rem;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
    }
    
    .category-filters::-webkit-scrollbar {
        display: none;
    }
    
    .links-grid {
        grid-template-columns: 1fr;
    }
    
    h1 {
        font-size: 1.8rem;
    }
    
    .modal {
        width: 95%;
        padding: 1.5rem;
    }
    
    .floating-btn {
        width: 50px;
        height: 50px;
    }
    
    .edit-mode-btn {
        bottom: 6rem;
        left: 1rem;
        width: 50px;
        height: 50px;
    }
    
    .theme-settings-btn {
        top: 70px;
        right: 20px;
    }
    
    .reset-data-btn {
        bottom: 6rem;
        left: 5.5rem;
        width: 36px;
        height: 36px;
    }
    
    .data-transfer-buttons {
        bottom: 2rem;
        right: 6rem; /* モバイルでは少し寄せる */
    }
    
    .btn-text {
        display: none; /* モバイルではテキストを非表示 */
    }
    
    .data-btn {
        width: 40px;
        height: 40px;
        padding: 0;
        justify-content: center;
    }
    
    .theme-colors {
        grid-template-columns: 1fr;
    }
}
    </style>
</head>
<body>
    <!-- 背景 -->
    <div class="background"></div>
    <ul class="circles">
        <li></li><li></li><li></li><li></li><li></li>
        <li></li><li></li><li></li><li></li><li></li>
    </ul>

    <!-- ダークモードトグル -->
    <button id="themeToggle" class="theme-toggle" title="テーマ切替">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
    </button>
    
    <!-- テーマ設定ボタン -->
    <button id="themeSettingsBtn" class="theme-settings-btn" title="テーマ設定">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
    </button>
    
    <!-- 時計とカレンダー -->
    <div class="clock-container">
      <div id="currentTime" class="current-time">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <div class="date-time-container">
          <div class="date-display" id="dateDisplay"></div>
          <div class="time-display" id="timeDisplay">読み込み中...</div>
        </div>
      </div>
      
      <div id="calendarPopup" class="calendar-popup">
        <div class="calendar-header">
          <button id="prevMonth" class="month-nav-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <div id="currentMonth">2023年5月</div>
          <button id="nextMonth" class="month-nav-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
        <div class="calendar-grid">
          <div class="weekday">日</div>
          <div class="weekday">月</div>
          <div class="weekday">火</div>
          <div class="weekday">水</div>
          <div class="weekday">木</div>
          <div class="weekday">金</div>
          <div class="weekday">土</div>
          <!-- 日付はJavaScriptで動的に生成されます -->
        </div>
      </div>
    </div>

    <div class="container">
        <div class="content">
            <div class="controls">
                <div class="search-container">
                    <input type="text" id="searchInput" class="search-input" placeholder="リンクを検索...">
                    <div class="search-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                    </div>
                </div>

                <div class="category-controls">
                    <div class="category-filters" id="categoryFilters">
                        <button class="category-filter active" data-category="all">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                            すべて
                        </button>
                        <!-- カテゴリーボタンはJSで動的に生成 -->
                    </div>
                    <button id="manageCategoriesBtn" class="manage-categories-btn" title="カテゴリー管理">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
                
                <!-- グループ選択 -->
                <div class="group-controls">
                    <div class="group-dropdown-container">
                        <select id="groupFilter" class="group-filter">
                            <option value="all">すべてのグループ</option>
                            <!-- グループはJSで動的に生成 -->
                        </select>
                        <div class="select-arrow">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </div>
                    </div>
                    <button id="manageGroupsBtn" class="manage-groups-btn" title="グループ管理">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </div>

            <div id="linksContainer" class="links-grid">
                <!-- リンクカードがJSで動的に生成 -->
            </div>

            <!-- ローディングインジケーター -->
            <div id="loadingIndicator" class="loading" style="display: none;">
                <span></span><span></span><span></span>
            </div>

            <!-- 空の状態表示 -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="8" y1="12" x2="16" y2="12"></line>
                    </svg>
                </div>
                <div>
                    <h3 class="empty-title">リンクがありません</h3>
                    <p class="empty-description">右下のボタンをクリックして新しいリンクを追加してください</p>
                </div>
            </div>
        </div>
    </div>

    <!-- フローティングアクションボタン -->
    <button id="addLinkBtn" class="floating-btn" title="リンクを追加">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
    </button>

    <!-- 配置編集モードボタン -->
    <button id="editModeBtn" class="floating-btn edit-mode-btn" title="配置編集モード">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="12" y1="8" x2="12" y2="16"></line>
            <line x1="8" y1="12" x2="16" y2="12"></line>
        </svg>
    </button>

    <!-- リンク追加/編集モーダル -->
    <div id="linkModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">
                    <div class="modal-title-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                    </div>
                    <span id="modalTitle">新しいリンクを追加</span>
                </div>
                <button id="closeModalBtn" class="modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="linkForm">
                <input type="hidden" id="linkId">
                <div class="form-group">
                    <label for="linkTitle" class="form-label">タイトル</label>
                    <input type="text" id="linkTitle" class="form-input" placeholder="サイト名を入力" required>
                </div>
                <div class="form-group">
                    <label for="linkUrl" class="form-label">URL</label>
                    <input type="url" id="linkUrl" class="form-input" placeholder="https://example.com" required>
                </div>
                <div class="form-group">
                    <label for="linkDescription" class="form-label">説明</label>
                    <textarea id="linkDescription" class="form-input form-textarea" placeholder="サイトの簡単な説明"></textarea>
                </div>
                <div class="form-group">
                    <label for="linkCategory" class="form-label">カテゴリー</label>
                    <select id="linkCategory" class="form-input form-select">
                        <!-- カテゴリーオプションはJSで動的に生成 -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="linkGroup" class="form-label">グループ</label>
                    <select id="linkGroup" class="form-input form-select">
                        <option value="">なし</option>
                        <!-- グループオプションはJSで動的に生成 -->
                    </select>
                </div>
                <button type="submit" class="btn btn-block">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                    <span id="submitBtnText">リンクを追加</span>
                </button>
            </form>
        </div>
    </div>

    <!-- カテゴリー管理モーダル -->
    <div id="categoryModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">
                    <div class="modal-title-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="8" y1="6" x2="21" y2="6"></line>
                            <line x1="8" y1="12" x2="21" y2="12"></line>
                            <line x1="8" y1="18" x2="21" y2="18"></line>
                            <line x1="3" y1="6" x2="3.01" y2="6"></line>
                            <line x1="3" y1="12" x2="3.01" y2="12"></line>
                            <line x1="3" y1="18" x2="3.01" y2="18"></line>
                        </svg>
                    </div>
                    カテゴリー管理
                </div>
                <button id="closeCategoryModalBtn" class="modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="category-list" id="categoryList">
                <!-- カテゴリーリストがJSで動的に生成 -->
            </div>
            <div class="form-group">
                <label for="newCategoryName" class="form-label">新しいカテゴリー</label>
                <div class="add-category-group">
                    <input type="text" id="newCategoryName" class="form-input" placeholder="カテゴリー名を入力">
                    <button id="addCategoryBtn" class="btn btn-small">追加</button>
                </div>
            </div>
        </div>
    </div>

    <!-- グループ管理モーダル -->
    <div id="groupModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">
                    <div class="modal-title-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <rect x="7" y="7" width="3" height="9"></rect>
                            <rect x="14" y="7" width="3" height="5"></rect>
                        </svg>
                    </div>
                    グループ管理
                </div>
                <button id="closeGroupModalBtn" class="modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="group-list" id="groupList">
                <!-- グループリストがJSで動的に生成 -->
            </div>
            <div class="form-group">
                <label for="newGroupName" class="form-label">新しいグループ</label>
                <div class="add-group-input">
                    <input type="text" id="newGroupName" class="form-input" placeholder="グループ名を入力">
                    <input type="color" id="newGroupColor" class="color-picker" value="#6366f1">
                    <button id="addGroupBtn" class="btn btn-small">追加</button>
                </div>
            </div>
        </div>
    </div>

    <!-- アイコン選択モーダル -->
    <div id="iconModal" class="modal-overlay">
        <div class="modal icon-selector-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <div class="modal-title-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                            <line x1="9" y1="9" x2="9.01" y2="9"></line>
                            <line x1="15" y1="9" x2="15.01" y2="9"></line>
                        </svg>
                    </div>
                    <span id="iconModalTitle">アイコンを選択</span>
                </div>
                <button id="closeIconModalBtn" class="modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="icon-grid" id="iconGrid">
                <!-- アイコンはJSで動的に生成 -->
            </div>
        </div>
    </div>

    <!-- テーマ設定モーダル -->
    <div id="themeSettingsModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">
                    <div class="modal-title-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                    </div>
                    テーマ設定
                </div>
                <button id="closeThemeSettingsBtn" class="modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="theme-settings-content">
                <div class="theme-option">
                    <span>モード</span>
                    <div class="theme-mode-toggle">
                        <button id="lightModeBtn" class="theme-mode-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="5"></circle>
                                <line x1="12" y1="1" x2="12" y2="3"></line>
                                <line x1="12" y1="21" x2="12" y2="23"></line>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                <line x1="1" y1="12" x2="3" y2="12"></line>
                                <line x1="21" y1="12" x2="23" y2="12"></line>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                            </svg>
                            ライト
                        </button>
                        <button id="darkModeBtn" class="theme-mode-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                            ダーク
                        </button>
                        <button id="autoModeBtn" class="theme-mode-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
<line x1="3" y1="12" x2="21" y2="12"></line>
                                <line x1="12" y1="3" x2="12" y2="21"></line>
                            </svg>
                            自動
                        </button>
                    </div>
                </div>
                
                <div class="theme-colors">
                    <div class="color-option">
                        <label for="primaryColor">プライマリーカラー</label>
                        <input type="color" id="primaryColor" class="color-picker" value="#6366f1">
                    </div>
                    
                    <div class="color-option">
                        <label for="bgGradient1">背景グラデーション（開始）</label>
                        <input type="color" id="bgGradient1" class="color-picker" value="#6b46b3">
                    </div>
                    
                    <div class="color-option">
                        <label for="bgGradient2">背景グラデーション（終了）</label>
                        <input type="color" id="bgGradient2" class="color-picker" value="#a76ec8">
                    </div>
                    
                    <div class="color-option">
                        <label for="textColor">テキストカラー</label>
                        <input type="color" id="textColor" class="color-picker" value="#ffffff">
                    </div>
                </div>
                
                <div class="theme-effects">
                    <div class="effect-option">
                        <label for="blurStrength">ブラー強度</label>
                        <input type="range" id="blurStrength" min="0" max="20" value="10" class="range-slider">
                        <span id="blurValue">10px</span>
                    </div>
                    
                    <div class="effect-option">
                        <label for="cardOpacity">カード透明度</label>
                        <input type="range" id="cardOpacity" min="1" max="9" value="1" class="range-slider">
                        <span id="opacityValue">0.1</span>
                    </div>
                    
                    <div class="effect-option">
                        <label for="animationSpeed">アニメーション速度</label>
                        <input type="range" id="animationSpeed" min="5" max="15" value="10" class="range-slider">
                        <span id="speedValue">普通</span>
                    </div>
                </div>
                
                <div class="font-settings">
                    <div class="font-option">
                        <label for="fontSize">フォントサイズ</label>
                        <select id="fontSize" class="form-input">
                            <option value="small">小</option>
                            <option value="medium" selected>中</option>
                            <option value="large">大</option>
                        </select>
                    </div>
                </div>
                
                <div class="theme-presets">
                    <button class="preset-btn" data-preset="default">デフォルト</button>
                    <button class="preset-btn" data-preset="ocean">オーシャン</button>
                    <button class="preset-btn" data-preset="sunset">サンセット</button>
                    <button class="preset-btn" data-preset="forest">フォレスト</button>
                    <button class="preset-btn" data-preset="minimal">ミニマル</button>
                </div>
                
                <div class="modal-actions">
                    <button id="resetThemeBtn" class="btn btn-outline">リセット</button>
                    <button id="applyThemeBtn" class="btn btn-primary">適用</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 一括インポートモーダル -->
    <div id="bulkImportModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">
                    <div class="modal-title-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                    </div>
                    <span>リンクの一括インポート</span>
                </div>
                <button id="closeBulkImportBtn" class="modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="import-tabs">
                <button class="import-tab active" data-tab="csv">CSVインポート</button>
                <button class="import-tab" data-tab="bookmark">ブックマークインポート</button>
                <button class="import-tab" data-tab="text">テキストインポート</button>
            </div>
            
            <div class="import-content active" id="csvImport">
                <p class="import-instructions">CSVファイルからリンクをインポートします。<br>CSVフォーマット: タイトル,URL,説明,カテゴリー</p>
                <div class="form-group">
                    <label for="csvFile" class="form-label">CSVファイル</label>
                    <input type="file" id="csvFile" class="form-input file-input" accept=".csv">
                </div>
                <div class="csv-preview">
                    <h4>プレビュー</h4>
                    <div id="csvPreview" class="preview-container"></div>
                </div>
            </div>
            
            <div class="import-content" id="bookmarkImport">
                <p class="import-instructions">HTMLブックマークファイルからリンクをインポートします。<br>ブラウザの「ブックマークをエクスポート」機能で出力したファイルを使用してください。</p>
                <div class="form-group">
                    <label for="bookmarkFile" class="form-label">HTMLブックマークファイル</label>
                    <input type="file" id="bookmarkFile" class="form-input file-input" accept=".html,.htm">
                </div>
                <div class="bookmark-preview">
                    <h4>プレビュー</h4>
                    <div id="bookmarkPreview" class="preview-container"></div>
                </div>
            </div>
            
            <div class="import-content" id="textImport">
                <p class="import-instructions">テキスト形式でリンクを一括入力します。<br>一行につき「タイトル,URL」の形式で入力してください。</p>
                <div class="form-group">
                    <label for="importText" class="form-label">リンクリスト</label>
                    <textarea id="importText" class="form-input form-textarea" rows="10" placeholder="Google,https://www.google.com"></textarea>
                </div>
            </div>
            
<div class="import-options">
    <label class="import-option">
        <input type="checkbox" id="skipDuplicates" checked>
        <span>重複するURLをスキップする</span>
    </label>
    <label class="import-option">
        <input type="checkbox" id="importToCategory">
        <span>すべてのリンクを特定のカテゴリーにインポート:</span>
        <select id="importCategory" class="inline-select">
            <!-- カテゴリーはJSで動的に生成 -->
        </select>
    </label>
</div>
            
            <div class="modal-actions">
                <button id="cancelImportBtn" class="btn btn-outline">キャンセル</button>
                <button id="processImportBtn" class="btn btn-primary">インポート</button>
            </div>
        </div>
    </div>

    <!-- トースト通知 -->
    <div id="toast" class="toast">
        <div class="toast-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        </div>
        <span id="toastMessage" class="toast-message">操作が完了しました</span>
    </div>
    
    <!-- データ転送ボタン -->
    <div class="data-transfer-buttons">
        <button id="exportDataBtn" class="data-btn export-btn" title="データをエクスポート">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            <span class="btn-text">エクスポート</span>
        </button>
        <button id="importDataBtn" class="data-btn import-btn" title="データをインポート">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <span class="btn-text">インポート</span>
        </button>
        <button id="bulkImportBtn" class="data-btn bulk-import-btn" title="リンクを一括インポート">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
            <span class="btn-text">一括インポート</span>
        </button>
    </div>
    
    <!-- リセットボタン -->
    <button id="resetDataBtn" class="reset-data-btn" title="データをリセット">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 6h18"></path>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
            <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
    </button>

    <!-- リセット確認モーダル -->
    <div id="resetModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">
                    <div class="modal-title-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"></polygon>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                    </div>
                    <span>データをリセット</span>
                </div>
                <button id="closeResetModalBtn" class="modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <p>すべてのデータ（リンク、カテゴリー、設定など）をリセットしてもよろしいですか？<br>この操作は元に戻すことができません。</p>
            <div class="reset-modal-actions">
                <button id="cancelResetBtn" class="btn btn-cancel">キャンセル</button>
                <button id="confirmResetBtn" class="btn btn-danger">すべて削除</button>
            </div>
        </div>
    </div>

    <script>
// SVGアイコンの定義
const svgIcons = {
    // 基本的なアイコン
    'home': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>`,
    'plus': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>`,
    'settings': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>`,
    'link': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>`,
    
    // カテゴリーアイコン
    'work': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>`,
    'code': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>`,
    'tool': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>`,
    'book': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>`,
    'info': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>`,
    
    // ソーシャルメディア/サービス
    'google': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="4"></circle><line x1="21.17" y1="8" x2="12" y2="8"></line><line x1="3.95" y1="6.06" x2="8.54" y2="14"></line><line x1="10.88" y1="21.94" x2="15.46" y2="14"></line></svg>`,
    'github': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>`,
    'slack': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="13" y="2" width="3" height="8" rx="1.5"></rect><path d="M19 8.5V10h1.5A1.5 1.5 0 1 0 19 8.5"></path><rect x="8" y="14" width="3" height="8" rx="1.5"></rect><path d="M5 15.5V14H3.5A1.5 1.5 0 1 0 5 15.5"></path><rect x="14" y="13" width="8" height="3" rx="1.5"></rect><path d="M15.5 19H14v1.5a1.5 1.5 0 1 0 1.5-1.5"></path><rect x="2" y="8" width="8" height="3" rx="1.5"></rect><path d="M8.5 5H10V3.5A1.5 1.5 0 1 0 8.5 5"></path></svg>`,
    'twitter': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path></svg>`,
    
    // グループアイコン
    'folder': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>`,
    'layers': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>`,
    'package': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>`,
    'clipboard': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>`,
    'table': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18"></path></svg>`,
    'grid': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>`,
    
    // 追加アイコン
    'calendar': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>`,
    'mail': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>`,
    'file': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>`,
    'cloud': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>`,
    'database': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>`,
    'server': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>`,
'book-open': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>`,
    'video': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>`,
    'music': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>`,
    'image': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>`,
    
    // ユーザー、コミュニケーション
    'user': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>`,
    'users': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,
    'message-circle': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>`,
    
    // 教育
    'graduation-cap': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c0 2 2 3 6 3s6-1 6-3v-5"></path></svg>`,
    
    // テーマ切り替え
    'sun': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`,
    'moon': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`,
    
    // インポート関連
    'upload': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>`,
    'download': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>`,
    'file-plus': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg>`,
    'file-text': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>`,
    'corner-down-right': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 10 20 15 15 20"></polyline><path d="M4 4v7a4 4 0 0 0 4 4h12"></path></svg>`,
    
    // UI要素
    'check': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`,
    'x': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`,
    'alert-triangle': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`,
    'alert-circle': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>`,
    
    // その他
    'star': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`,
    'bookmark': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>`,
    'globe': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>`,
    'map-pin': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>`,
    'phone': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>`,
    'sliders': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg>`,
    'map': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></svg>`,
    'help-circle': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`,
    'save': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>`,
    'trash': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`,
    'edit': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>`,
    'more-horizontal': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg>`,
};
    </script>
    <script>
// DOM要素への参照
const themeToggle = document.getElementById('themeToggle');
const themeSettingsBtn = document.getElementById('themeSettingsBtn');
const addLinkBtn = document.getElementById('addLinkBtn');
const editModeBtn = document.getElementById('editModeBtn');
const linkModal = document.getElementById('linkModal');
const closeModalBtn = document.getElementById('closeModalBtn');
const linkForm = document.getElementById('linkForm');
const linksContainer = document.getElementById('linksContainer');
const loadingIndicator = document.getElementById('loadingIndicator');
const emptyState = document.getElementById('emptyState');
const searchInput = document.getElementById('searchInput');
const categoryFilters = document.getElementById('categoryFilters');
const groupFilter = document.getElementById('groupFilter');
const toast = document.getElementById('toast');
const toastMessage = document.getElementById('toastMessage');
const manageCategoriesBtn = document.getElementById('manageCategoriesBtn');
const manageGroupsBtn = document.getElementById('manageGroupsBtn');
const categoryModal = document.getElementById('categoryModal');
const groupModal = document.getElementById('groupModal');
const closeCategoryModalBtn = document.getElementById('closeCategoryModalBtn');
const closeGroupModalBtn = document.getElementById('closeGroupModalBtn');
const categoryList = document.getElementById('categoryList');
const groupList = document.getElementById('groupList');
const newCategoryName = document.getElementById('newCategoryName');
const newGroupName = document.getElementById('newGroupName');
const newGroupColor = document.getElementById('newGroupColor');
const addCategoryBtn = document.getElementById('addCategoryBtn');
const addGroupBtn = document.getElementById('addGroupBtn');
const linkCategory = document.getElementById('linkCategory');
const linkGroup = document.getElementById('linkGroup');
const modalTitle = document.getElementById('modalTitle');
const submitBtnText = document.getElementById('submitBtnText');
const linkId = document.getElementById('linkId');

// テーマ設定モーダル
const themeSettingsModal = document.getElementById('themeSettingsModal');
const closeThemeSettingsBtn = document.getElementById('closeThemeSettingsBtn');
const primaryColor = document.getElementById('primaryColor');
const bgGradient1 = document.getElementById('bgGradient1');
const bgGradient2 = document.getElementById('bgGradient2');
const textColor = document.getElementById('textColor');
const blurStrength = document.getElementById('blurStrength');
const blurValue = document.getElementById('blurValue');
const cardOpacity = document.getElementById('cardOpacity');
const opacityValue = document.getElementById('opacityValue');
const animationSpeed = document.getElementById('animationSpeed');
const speedValue = document.getElementById('speedValue');
const fontSize = document.getElementById('fontSize');
const resetThemeBtn = document.getElementById('resetThemeBtn');
const applyThemeBtn = document.getElementById('applyThemeBtn');
const lightModeBtn = document.getElementById('lightModeBtn');
const darkModeBtn = document.getElementById('darkModeBtn');
const autoModeBtn = document.getElementById('autoModeBtn');
const presetBtns = document.querySelectorAll('.preset-btn');

// 一括インポートモーダル
const bulkImportBtn = document.getElementById('bulkImportBtn');
const bulkImportModal = document.getElementById('bulkImportModal');
const closeBulkImportBtn = document.getElementById('closeBulkImportBtn');
const importTabs = document.querySelectorAll('.import-tab');
const importContents = document.querySelectorAll('.import-content');
const csvFile = document.getElementById('csvFile');
const bookmarkFile = document.getElementById('bookmarkFile');
const importText = document.getElementById('importText');
const csvPreview = document.getElementById('csvPreview');
const bookmarkPreview = document.getElementById('bookmarkPreview');
const skipDuplicates = document.getElementById('skipDuplicates');
const importToCategory = document.getElementById('importToCategory');
const importCategory = document.getElementById('importCategory');
const cancelImportBtn = document.getElementById('cancelImportBtn');
const processImportBtn = document.getElementById('processImportBtn');

// アイコン選択モーダル要素
const iconModal = document.getElementById('iconModal');
const closeIconModalBtn = document.getElementById('closeIconModalBtn');
const iconGrid = document.getElementById('iconGrid');
const iconModalTitle = document.getElementById('iconModalTitle');

// リセット関連
const resetDataBtn = document.getElementById('resetDataBtn');
const resetModal = document.getElementById('resetModal');
const closeResetModalBtn = document.getElementById('closeResetModalBtn');
const cancelResetBtn = document.getElementById('cancelResetBtn');
const confirmResetBtn = document.getElementById('confirmResetBtn');

// データエクスポート/インポート関連
const exportDataBtn = document.getElementById('exportDataBtn');
const importDataBtn = document.getElementById('importDataBtn');

// 配置編集モード関連の変数
let isEditMode = false;
let selectedCards = [];
const MAX_SELECTED = 2;

// 現在編集中のカテゴリー名を保持
let currentEditingCategory = '';
// 現在編集中のグループ名を保持
let currentEditingGroup = '';

// デフォルトのカテゴリー
const defaultCategories = ['ツール'];
// デフォルトのグループ
const defaultGroups = [];

// デフォルトテーマ設定
const defaultThemeSettings = {
    mode: 'auto',
    primaryColor: '#6366f1',
    bgGradient1: '#6b46b3',
    bgGradient2: '#a76ec8',
    textColor: '#ffffff',
    blurStrength: 10,
    cardOpacity: 1,
    animationSpeed: 10,
    fontSize: 'medium'
};

// テーマプリセット
const themePresets = {
    default: {
        mode: 'auto',
        primaryColor: '#6366f1',
        bgGradient1: '#6b46b3',
        bgGradient2: '#a76ec8',
        textColor: '#ffffff',
        blurStrength: 10,
        cardOpacity: 1,
        animationSpeed: 10,
        fontSize: 'medium'
    },
    ocean: {
        mode: 'auto',
        primaryColor: '#06b6d4',
        bgGradient1: '#0c4a6e',
        bgGradient2: '#0891b2',
        textColor: '#f0f9ff',
        blurStrength: 12,
        cardOpacity: 2,
        animationSpeed: 8,
        fontSize: 'medium'
    },
    sunset: {
        mode: 'auto',
        primaryColor: '#f97316',
        bgGradient1: '#7c2d12',
        bgGradient2: '#fdba74',
        textColor: '#fff7ed',
        blurStrength: 8,
        cardOpacity: 1,
        animationSpeed: 12,
        fontSize: 'medium'
    },
    forest: {
        mode: 'auto',
        primaryColor: '#16a34a',
        bgGradient1: '#14532d',
        bgGradient2: '#4ade80',
        textColor: '#f0fdf4',
        blurStrength: 8,
        cardOpacity: 1,
        animationSpeed: 15,
        fontSize: 'medium'
    },
    minimal: {
        mode: 'auto',
        primaryColor: '#525252',
        bgGradient1: '#18181b',
        bgGradient2: '#3f3f46',
        textColor: '#f5f5f5',
        blurStrength: 5,
        cardOpacity: 3,
        animationSpeed: 5,
        fontSize: 'medium'
    }
};

// ローカルストレージからカテゴリーを取得する関数
function getCategories() {
    const categories = localStorage.getItem('portalCategories');
    return categories ? JSON.parse(categories) : defaultCategories;
}

// カテゴリーの順序を取得する関数
function getCategoryOrder() {
    const order = localStorage.getItem('portalCategoryOrder');
    return order ? JSON.parse(order) : getCategories();
}

// カテゴリーの順序を保存する関数
function saveCategoryOrder(order) {
    localStorage.setItem('portalCategoryOrder', JSON.stringify(order));
}

// ローカルストレージからグループを取得する関数
function getGroups() {
    const groups = localStorage.getItem('portalGroups');
    return groups ? JSON.parse(groups) : defaultGroups;
}

// グループの順序を取得する関数
function getGroupOrder() {
    const order = localStorage.getItem('portalGroupOrder');
    return order ? JSON.parse(order) : getGroups();
}

// グループの順序を保存する関数
function saveGroupOrder(order) {
    localStorage.setItem('portalGroupOrder', JSON.stringify(order));
}

// グループの色を取得する関数
function getGroupColors() {
    const colors = localStorage.getItem('portalGroupColors');
    return colors ? JSON.parse(colors) : {};
}

// グループの色を保存する関数
function saveGroupColors(colors) {
    localStorage.setItem('portalGroupColors', JSON.stringify(colors));
}

// カテゴリーを移動する関数
function moveCategory(categoryName, direction) {
    const categories = getCategories();
    const currentOrder = getCategoryOrder();
    
    // インデックスを取得
    const currentIndex = currentOrder.indexOf(categoryName);
    
    // 移動先を計算
    let targetIndex;
    if (direction === 'up' && currentIndex > 0) {
        targetIndex = currentIndex - 1;
    } else if (direction === 'down' && currentIndex < currentOrder.length - 1) {
        targetIndex = currentIndex + 1;
    } else {
        // 最上部または最下部の場合は何もしない
        return;
    }
    
    // 順序を入れ替え
    [currentOrder[currentIndex], currentOrder[targetIndex]] = 
    [currentOrder[targetIndex], currentOrder[currentIndex]];
    
// 新しい順序を保存
    saveCategoryOrder(currentOrder);
    
    // UIを更新
    renderCategoryList();
    renderCategoryFilters();
    
    showToast(direction === 'up' ? 
        `カテゴリー「${categoryName}」を上に移動しました` : 
        `カテゴリー「${categoryName}」を下に移動しました`);
}

// グループを移動する関数
function moveGroup(groupName, direction) {
    const groups = getGroups();
    const currentOrder = getGroupOrder();
    
    // インデックスを取得
    const currentIndex = currentOrder.indexOf(groupName);
    
    // 移動先を計算
    let targetIndex;
    if (direction === 'up' && currentIndex > 0) {
        targetIndex = currentIndex - 1;
    } else if (direction === 'down' && currentIndex < currentOrder.length - 1) {
        targetIndex = currentIndex + 1;
    } else {
        // 最上部または最下部の場合は何もしない
        return;
    }
    
    // 順序を入れ替え
    [currentOrder[currentIndex], currentOrder[targetIndex]] = 
    [currentOrder[targetIndex], currentOrder[currentIndex]];
    
    // 新しい順序を保存
    saveGroupOrder(currentOrder);
    
    // UIを更新
    renderGroupList();
    renderGroupFilter();
    
    showToast(direction === 'up' ? 
        `グループ「${groupName}」を上に移動しました` : 
        `グループ「${groupName}」を下に移動しました`);
}

// カテゴリーをローカルストレージに保存する関数
function saveCategories(categories) {
    localStorage.setItem('portalCategories', JSON.stringify(categories));
}

// グループをローカルストレージに保存する関数
function saveGroups(groups) {
    localStorage.setItem('portalGroups', JSON.stringify(groups));
}

// カテゴリーアイコンをローカルストレージから取得
function getCategoryIcons() {
    const icons = localStorage.getItem('portalCategoryIcons');
    return icons ? JSON.parse(icons) : {
        'ツール': 'tool'
    };
}

// カテゴリーアイコンをローカルストレージに保存
function saveCategoryIcons(icons) {
    localStorage.setItem('portalCategoryIcons', JSON.stringify(icons));
}

// カテゴリーのアイコンを更新する関数
function updateCategoryIcon(categoryName, iconKey) {
    const categoryIcons = getCategoryIcons();
    categoryIcons[categoryName] = iconKey;
    saveCategoryIcons(categoryIcons);
    
    // カテゴリーリストを再レンダリング
    renderCategoryList();
    // カテゴリーフィルターも更新
    renderCategoryFilters();
    
    // モーダルを閉じる
    closeIconModal();
    
    showToast(`「${categoryName}」のアイコンを更新しました`);
}

// テーマ設定をローカルストレージから取得
function getThemeSettings() {
    const settings = localStorage.getItem('portalThemeSettings');
    return settings ? JSON.parse(settings) : defaultThemeSettings;
}

// テーマ設定をローカルストレージに保存
function saveThemeSettings(settings) {
    localStorage.setItem('portalThemeSettings', JSON.stringify(settings));
}

// テーマ設定を適用する関数
function applyThemeSettings(settings) {
    const root = document.documentElement;
    
    // CSSカスタム変数を設定
    root.style.setProperty('--primary', settings.primaryColor);
    root.style.setProperty('--blur-strength', `${settings.blurStrength}px`);
    root.style.setProperty('--glass-bg', `rgba(255, 255, 255, ${settings.cardOpacity / 10})`);
    root.style.setProperty('--bg-gradient-1', settings.bgGradient1);
    root.style.setProperty('--bg-gradient-2', settings.bgGradient2);
    root.style.setProperty('--bg-gradient-3', settings.bgGradient2);
    root.style.setProperty('--text-color', settings.textColor);
    root.style.setProperty('--animation-speed', `${30 - settings.animationSpeed * 2}s`);
    
    // フォントサイズの適用
    document.body.classList.remove('font-small', 'font-medium', 'font-large');
    document.body.classList.add(`font-${settings.fontSize}`);
    
    // テーマモードの適用
    if (settings.mode === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
        // アイコン切り替え
        themeToggle.innerHTML = svgIcons.moon;
    } else if (settings.mode === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        // アイコン切り替え
        themeToggle.innerHTML = svgIcons.sun;
        // ダークモード時は背景グラデーションを固定
        root.style.setProperty('--bg-gradient-1', '#121212');
        root.style.setProperty('--bg-gradient-2', '#2D3748');
        root.style.setProperty('--bg-gradient-3', '#1A202C');
    } else {
        // 自動モード（システム設定に従う）
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.setAttribute('data-theme', 'dark');
            themeToggle.innerHTML = svgIcons.sun;
            // ダークモード時は背景グラデーションを固定
            root.style.setProperty('--bg-gradient-1', '#121212');
            root.style.setProperty('--bg-gradient-2', '#2D3748');
            root.style.setProperty('--bg-gradient-3', '#1A202C');
        } else {
            document.documentElement.setAttribute('data-theme', 'light');
            themeToggle.innerHTML = svgIcons.moon;
        }
    }
    
    // テーマ設定フォームを更新
    updateThemeSettingsForm(settings);
}

// テーマ設定フォームを更新する関数
function updateThemeSettingsForm(settings) {
    primaryColor.value = settings.primaryColor;
    bgGradient1.value = settings.bgGradient1;
    bgGradient2.value = settings.bgGradient2;
    textColor.value = settings.textColor;
    blurStrength.value = settings.blurStrength;
    blurValue.textContent = `${settings.blurStrength}px`;
    cardOpacity.value = settings.cardOpacity;
    opacityValue.textContent = `0.${settings.cardOpacity}`;
    animationSpeed.value = settings.animationSpeed;
    
    // アニメーション速度の表示をわかりやすく
    if (settings.animationSpeed <= 5) {
        speedValue.textContent = '遅い';
    } else if (settings.animationSpeed <= 10) {
        speedValue.textContent = '普通';
    } else {
        speedValue.textContent = '速い';
    }
    
    fontSize.value = settings.fontSize;
    
    // モードボタンのアクティブ状態を更新
    lightModeBtn.classList.remove('active');
    darkModeBtn.classList.remove('active');
    autoModeBtn.classList.remove('active');
    
    if (settings.mode === 'light') {
        lightModeBtn.classList.add('active');
    } else if (settings.mode === 'dark') {
        darkModeBtn.classList.add('active');
    } else {
        autoModeBtn.classList.add('active');
    }
    
    // ダークモードかどうかをチェック
    const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
    
    // ダークモード時は背景グラデーション設定を無効化
    if (isDarkMode) {
        bgGradient1.disabled = true;
        bgGradient2.disabled = true;
        bgGradient1.style.opacity = '0.5';
        bgGradient2.style.opacity = '0.5';
        // ツールチップを追加
        bgGradient1.title = 'ダークモードでは編集できません';
        bgGradient2.title = 'ダークモードでは編集できません';
    } else {
        bgGradient1.disabled = false;
        bgGradient2.disabled = false;
        bgGradient1.style.opacity = '1';
        bgGradient2.style.opacity = '1';
        bgGradient1.title = '';
        bgGradient2.title = '';
    }
}

// ダークモード切り替え
function toggleTheme() {
    const settings = getThemeSettings();
    if (document.documentElement.getAttribute('data-theme') === 'dark') {
        // ダークモードからライトモードへ
        settings.mode = 'light';
    } else {
        // ライトモードからダークモードへ
        settings.mode = 'dark';
    }
    
    saveThemeSettings(settings);
    applyThemeSettings(settings);
    
    showToast(settings.mode === 'dark' ? 'ダークモードに切り替えました' : 'ライトモードに切り替えました');
}

// モーダルの開閉
function openLinkModal(mode = 'add', link = null) {
    linkModal.classList.add('active');
    setTimeout(() => {
        document.getElementById('linkTitle').focus();
    }, 100);
    addLinkBtn.classList.add('active');
    
    if (mode === 'edit' && link) {
        modalTitle.textContent = 'リンクを編集';
        submitBtnText.textContent = '更新する';
        document.getElementById('linkId').value = link.id;
        document.getElementById('linkTitle').value = link.title;
        document.getElementById('linkUrl').value = link.url;
        document.getElementById('linkDescription').value = link.description || '';
        document.getElementById('linkCategory').value = link.category || 'ツール';
        document.getElementById('linkGroup').value = link.group || '';
    } else {
        modalTitle.textContent = '新しいリンクを追加';
        submitBtnText.textContent = 'リンクを追加';
        linkForm.reset();
        document.getElementById('linkId').value = '';
    }
}

function closeLinkModal() {
    linkModal.classList.remove('active');
    addLinkBtn.classList.remove('active');
    setTimeout(() => {
        linkForm.reset();
    }, 300);
}

function openCategoryModal() {
    categoryModal.classList.add('active');
    renderCategoryList();
}

function closeCategoryModal() {
    categoryModal.classList.remove('active');
    setTimeout(() => {
        newCategoryName.value = '';
    }, 300);
}

function openGroupModal() {
    groupModal.classList.add('active');
    renderGroupList();
}

function closeGroupModal() {
    groupModal.classList.remove('active');
    setTimeout(() => {
        newGroupName.value = '';
    }, 300);
}

function openThemeSettingsModal() {
    const settings = getThemeSettings();
    updateThemeSettingsForm(settings);
    themeSettingsModal.classList.add('active');
}

function closeThemeSettingsModal() {
    themeSettingsModal.classList.remove('active');
}

function openBulkImportModal() {
    // インポートカテゴリの選択肢を更新
    updateImportCategorySelect();
    bulkImportModal.classList.add('active');
}

function closeBulkImportModal() {
    bulkImportModal.classList.remove('active');
    // インプットをリセット
    csvFile.value = '';
    bookmarkFile.value = '';
    importText.value = '';
    csvPreview.innerHTML = '';
    bookmarkPreview.innerHTML = '';
}

// インポートカテゴリ選択肢を更新
function updateImportCategorySelect() {
    const categories = getCategories();
    importCategory.innerHTML = '';
    
    categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        importCategory.appendChild(option);
    });
}

// インポートグループ選択肢を更新
function updateImportGroupSelect() {
    const groups = getGroups();
    importGroup.innerHTML = '<option value="">選択してください</option>';
    
    groups.forEach(group => {
        const option = document.createElement('option');
        option.value = group;
        option.textContent = group;
        importGroup.appendChild(option);
    });
}

// アイコングリッドをレンダリング
function renderIconGrid(categoryName) {
    iconGrid.innerHTML = '';
    const categoryIcons = getCategoryIcons();
    const currentIcon = categoryIcons[categoryName] || 'info';
    
    // アイコンをカテゴリーごとにグループ化
    const iconCategories = {
        '基本': ['home', 'plus', 'settings', 'link', 'info'],
        'カテゴリー': ['work', 'code', 'tool', 'book'],
        'グループ': ['folder', 'layers', 'package', 'clipboard', 'table', 'grid'],
        'ソーシャル': ['google', 'github', 'slack', 'twitter'],
        'オフィス': ['calendar', 'mail', 'file', 'cloud', 'database', 'server'],
        'メディア': ['book-open', 'video', 'music', 'image'],
        '場所': ['map', 'map-pin', 'globe'],
        'ユーザー': ['user', 'users', 'message-circle', 'phone'],
        'その他': ['star', 'bookmark', 'help-circle', 'graduation-cap']
    };
    
    // カテゴリーごとにアイコンを表示
    for (const [category, icons] of Object.entries(iconCategories)) {
        // カテゴリーヘッダーを追加
        const categoryHeader = document.createElement('div');
        categoryHeader.className = 'icon-category-header';
        categoryHeader.textContent = category;
        iconGrid.appendChild(categoryHeader);
        
        // アイコンのグリッドコンテナを作成
        const gridContainer = document.createElement('div');
        gridContainer.className = 'icon-grid-container';
        
        // カテゴリー内のアイコンを追加
        icons.forEach(iconKey => {
            if (svgIcons[iconKey]) {
                const iconElement = document.createElement('div');
                iconElement.className = `icon-item ${iconKey === currentIcon ? 'selected' : ''}`;
                iconElement.dataset.icon = iconKey;
                iconElement.innerHTML = svgIcons[iconKey];
                
                iconElement.addEventListener('click', () => {
                    // 以前の選択を解除
                    document.querySelectorAll('.icon-item.selected').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // 新しい選択を設定
                    iconElement.classList.add('selected');
                    
                    // アイコンを更新
                    updateCategoryIcon(currentEditingCategory, iconKey);
                });
                
                gridContainer.appendChild(iconElement);
            }
        });
        
        iconGrid.appendChild(gridContainer);
    }
}

// アイコン選択モーダルを開く
function openIconModal(categoryName) {
    currentEditingCategory = categoryName;
    iconModalTitle.textContent = `「${categoryName}」のアイコンを選択`;
    iconModal.classList.add('active');
    renderIconGrid(categoryName);
}

// アイコン選択モーダルを閉じる
function closeIconModal() {
    iconModal.classList.remove('active');
    currentEditingCategory = '';
}

// 編集モードの切り替え
function toggleEditMode() {
    isEditMode = !isEditMode;
    
    if (isEditMode) {
        // 編集モード開始
        editModeBtn.classList.add('active');
        showToast('配置編集モードを開始しました。入れ替えたい2つのカードを選択してください');
        
        // カードに選択可能スタイルを適用
        document.querySelectorAll('.link-card').forEach(card => {
            card.classList.add('editable');
        });
        
        // 編集モード終了バナーを表示
        showEditModeBanner();
    } else {
        // 編集モード終了
        editModeBtn.classList.remove('active');
        hideEditModeBanner();
        
        // カードの選択状態をクリア
        clearSelectedCards();
        
        // カードから編集スタイルを削除
        document.querySelectorAll('.link-card').forEach(card => {
            card.classList.remove('editable');
        });
        
        showToast('配置編集モードを終了しました');
    }
}

// 編集モードバナーの表示
function showEditModeBanner() {
    // 既存のバナーがあれば削除
    hideEditModeBanner();
    
    const banner = document.createElement('div');
    banner.id = 'editModeBanner';
    banner.className = 'edit-mode-banner';
    banner.innerHTML = `
        <div class="edit-mode-banner-content">
            <span>配置編集モード - 入れ替えたい2つのカードを選択してください</span>
            <button id="exitEditModeBtn" class="btn btn-small">終了する</button>
        </div>
    `;
    
    document.querySelector('.content').insertBefore(banner, document.querySelector('.links-grid'));
    
    // 終了ボタンのイベント
    document.getElementById('exitEditModeBtn').addEventListener('click', toggleEditMode);
}

// 編集モードバナーの非表示
function hideEditModeBanner() {
    const banner = document.getElementById('editModeBanner');
    if (banner) {
        banner.remove();
    }
}

// カードの選択処理
function handleCardSelection(card) {
    if (!isEditMode) return;
    
    const cardId = card.dataset.id;
    const isSelected = card.classList.contains('selected');
    
    if (isSelected) {
        // 選択済みカードの選択を解除
        card.classList.remove('selected');
        selectedCards = selectedCards.filter(id => id !== cardId);
    } else {
        // 新しいカードを選択
        if (selectedCards.length < MAX_SELECTED) {
            card.classList.add('selected');
            selectedCards.push(cardId);
            
            // 2つのカードが選択されたら入れ替え処理
            if (selectedCards.length === MAX_SELECTED) {
                swapCards(selectedCards[0], selectedCards[1]);
            }
        }
    }
}

// カードを入れ替える処理
function swapCards(id1, id2) {
    const links = getLinks();
    const link1 = links.find(link => link.id === id1);
    const link2 = links.find(link => link.id === id2);
    
    if (link1 && link2) {
        // 順序を入れ替え
        const tempOrder = link1.order;
        link1.order = link2.order;
        link2.order = tempOrder;
        
        // リンクを保存
        saveLinks(links);
        
        // 選択状態をリセット
        clearSelectedCards();
        
        // 現在のフィルター状態を維持して再レンダリング
        const activeCategory = document.querySelector('.category-filter.active').dataset.category;
        const activeGroup = groupFilter.value;
        renderLinks(searchInput.value, activeCategory, activeGroup);
        
        showToast('カードの位置を入れ替えました');
    }
}

// 選択状態のリセット
function clearSelectedCards() {
    document.querySelectorAll('.link-card.selected').forEach(card => {
        card.classList.remove('selected');
    });
    selectedCards = [];
}

// カードを上下に移動する関数
function moveCard(id, direction) {
    let links = getLinks();
    
    // 現在のフィルター状態を取得
    const activeCategory = document.querySelector('.category-filter.active').dataset.category;
    const activeGroup = groupFilter.value;
    const searchTerm = searchInput.value;
    
    // 表示中のリンク（フィルタリング後）を取得し、現在の表示順序を保持
    const filteredLinks = getFilteredLinks(links, searchTerm, activeCategory, activeGroup);
    
    // 移動対象のリンクのフィルター内でのインデックスを取得
    const currentFilteredIndex = filteredLinks.findIndex(link => link.id === id);
    
    if (currentFilteredIndex === -1) return;
    
    // 移動先のインデックスを決定
    let targetFilteredIndex;
    if (direction === 'up' && currentFilteredIndex > 0) {
        targetFilteredIndex = currentFilteredIndex - 1;
    } else if (direction === 'down' && currentFilteredIndex < filteredLinks.length - 1) {
        targetFilteredIndex = currentFilteredIndex + 1;
    } else {
        // 最上部または最下部の場合は何もしない
        return;
    }
    
    // 交換するリンクのIDを取得
    const targetId = filteredLinks[targetFilteredIndex].id;
    
    // すべてのリンクに順序値を再設定（現在の配列順序に基づく）
    links.forEach((link, index) => {
        link.order = index;
    });
    
    // 移動対象と交換対象のリンクのインデックスを取得
    const currentIndex = links.findIndex(link => link.id === id);
    const targetIndex = links.findIndex(link => link.id === targetId);
    
    // 配列内の位置を入れ替え
    if (currentIndex !== -1 && targetIndex !== -1) {
        // 配列内の要素を入れ替え
        [links[currentIndex], links[targetIndex]] = [links[targetIndex], links[currentIndex]];
        
        // 順序プロパティも更新
        [links[currentIndex].order, links[targetIndex].order] = [links[targetIndex].order, links[currentIndex].order];
        
        // リンクを保存
        saveLinks(links);
        
        // 現在のフィルター状態を維持して再レンダリング
        renderLinks(searchTerm, activeCategory, activeGroup);
        
        showToast(direction === 'up' ? 'カードを上に移動しました' : 'カードを下に移動しました');
    }
}

// トースト通知を表示する関数
function showToast(message) {
    toastMessage.textContent = message;
    toast.classList.add('active');
    
    setTimeout(() => {
        toast.classList.remove('active');
    }, 3000);
}

// カテゴリーからアイコンを取得
function getIconForCategory(category) {
    const categoryIcons = getCategoryIcons();
    const iconKey = categoryIcons[category] || 'info';
    return svgIcons[iconKey] || svgIcons.info;
}

// グループの色を取得
function getColorForGroup(group) {
    const groupColors = getGroupColors();
    return groupColors[group] || '#6366f1';
}

// URLからアイコンを自動検出する関数
function getIconFromUrl(url, category) {
    // カテゴリーがある場合はカテゴリーに基づいてアイコンを返す
    if (category) {
        return getIconForCategory(category);
    }
    
    try {
        const domain = new URL(url).hostname.toLowerCase();
        
        if (domain.includes('google')) return svgIcons.google;
        if (domain.includes('github')) return svgIcons.github;
        if (domain.includes('slack')) return svgIcons.slack;
        
        // デフォルトアイコン
        return svgIcons.link;
    } catch (e) {
        return svgIcons.link;
    }
}

// ローカルストレージからリンクを取得する関数
function getLinks() {
    const links = localStorage.getItem('portalLinks');
    return links ? JSON.parse(links) : [
        {
            id: 'default-1',
            title: 'Google',
            url: 'https://www.google.com',
            description: '世界最大の検索エンジン。情報検索や各種Googleサービスへのアクセスに利用します。',
            category: 'ツール',
            group: '',
            order: 0
        }
    ];
}

// リンクをローカルストレージに保存する関数
function saveLinks(links) {
    localStorage.setItem('portalLinks', JSON.stringify(links));
}

// フィルタリングされたリンクを取得する関数
function getFilteredLinks(links, searchTerm = '', category = 'all') {
    return links.filter(link => {
        const matchesSearch = searchTerm === '' || 
            link.title.toLowerCase().includes(searchTerm.toLowerCase()) || 
            (link.description && link.description.toLowerCase().includes(searchTerm.toLowerCase())) ||
            link.url.toLowerCase().includes(searchTerm.toLowerCase());
        
        const matchesCategory = category === 'all' || link.category === category;
        
        return matchesSearch && matchesCategory;
    });
}

// グループ選択部分を非表示にする
function renderCategoryFilters() {
    const categories = getCategories();
    const categoryOrder = getCategoryOrder();
    const activeCategory = document.querySelector('.category-filter.active')?.dataset.category || 'all';
    
    // "すべて" ボタン以外をクリア
    const allCategoryBtn = categoryFilters.querySelector('[data-category="all"]');
    categoryFilters.innerHTML = '';
    categoryFilters.appendChild(allCategoryBtn);
    
    // 各カテゴリーのボタンを順序に従って生成
    categoryOrder.forEach(category => {
        if (!categories.includes(category)) return; // 削除されたカテゴリーをスキップ
        
        const icon = getIconForCategory(category);
        const btn = document.createElement('button');
        btn.className = `category-filter${category === activeCategory ? ' active' : ''}`;
        btn.dataset.category = category;
        btn.innerHTML = `${icon} ${category}`;
        categoryFilters.appendChild(btn);
    });
    
    // カテゴリーセレクトボックスを更新
    updateCategorySelect();
}

// グループフィルターを生成する関数
function renderGroupFilter() {
    const groups = getGroups();
    const groupOrder = getGroupOrder();
    const activeGroup = groupFilter.value || 'all';
    
    // セレクトをクリア
    groupFilter.innerHTML = '<option value="all">すべてのグループ</option>';
    
    // 各グループのオプションを順序に従って生成
    groupOrder.forEach(group => {
        if (!groups.includes(group)) return; // 削除されたグループをスキップ
        
        const option = document.createElement('option');
        option.value = group;
        option.textContent = group;
        option.selected = group === activeGroup;
        groupFilter.appendChild(option);
    });
    
    // グループセレクトボックスを更新
    updateGroupSelect();
}

// リンクカテゴリーセレクトボックスを更新する関数
function updateCategorySelect() {
    const categories = getCategories();
    linkCategory.innerHTML = '';
    
    categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        linkCategory.appendChild(option);
    });
}

// リンクグループセレクトボックスを更新する関数
function updateGroupSelect() {
    const groups = getGroups();
    linkGroup.innerHTML = '<option value="">なし</option>';
    
    groups.forEach(group => {
        const option = document.createElement('option');
        option.value = group;
        option.textContent = group;
        linkGroup.appendChild(option);
    });
}

// カテゴリー管理リストを生成する関数
function renderCategoryList() {
    const categories = getCategories();
    const categoryOrder = getCategoryOrder();
    const categoryIcons = getCategoryIcons();
    categoryList.innerHTML = '';
    
    // 順序に基づいてカテゴリーを表示
    categoryOrder.forEach(category => {
        if (!categories.includes(category)) return; // 削除されたカテゴリーをスキップ
        
        const iconKey = categoryIcons[category] || 'info';
        const icon = svgIcons[iconKey] || svgIcons.info;
        
        const item = document.createElement('div');
        item.className = 'category-item';
        
        // 移動ボタンを追加
        const positionControls = `
            <div class="category-position-controls">
                <button class="position-btn move-category-up-btn" data-category="${category}" title="上へ移動">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="18 15 12 9 6 15"></polyline>
                    </svg>
                </button>
                <button class="position-btn move-category-down-btn" data-category="${category}" title="下へ移動">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
            </div>
        `;
        
        // すべてのカテゴリーは編集、削除が可能に変更
        item.innerHTML = `
            <div class="category-name">
                <span class="category-icon">${icon}</span>
                ${category}
            </div>
            <div class="category-actions">
                ${positionControls}
                <button class="icon-btn edit-category-btn" data-category="${category}" title="編集">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
</button>
                <button class="icon-btn change-icon-btn" data-category="${category}" title="アイコン変更">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                </button>
                <button class="icon-btn delete-category-btn" data-category="${category}" title="削除">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                </button>
            </div>
        `;
        
        categoryList.appendChild(item);
    });
    
    // カテゴリー編集イベント
    document.querySelectorAll('.edit-category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const category = this.dataset.category;
            const newName = prompt('カテゴリー名を編集', category);
            
            if (newName && newName !== category) {
                editCategory(category, newName);
            }
        });
    });
    
    // アイコン変更イベント
    document.querySelectorAll('.change-icon-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const category = this.dataset.category;
            openIconModal(category);
        });
    });
    
    // カテゴリー削除イベント
    document.querySelectorAll('.delete-category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const category = this.dataset.category;
            if (confirm(`カテゴリー「${category}」を削除しますか？`)) {
                deleteCategory(category);
            }
        });
    });
    
    // カテゴリー移動イベント
    document.querySelectorAll('.move-category-up-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const category = this.dataset.category;
            moveCategory(category, 'up');
        });
    });
    
    document.querySelectorAll('.move-category-down-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const category = this.dataset.category;
            moveCategory(category, 'down');
        });
    });
}

// グループ管理リストを生成する関数
function renderGroupList() {
    const groups = getGroups();
    const groupOrder = getGroupOrder();
    const groupColors = getGroupColors();
    groupList.innerHTML = '';
    
    // 順序に基づいてグループを表示
    groupOrder.forEach(group => {
        if (!groups.includes(group)) return; // 削除されたグループをスキップ
        
        const color = groupColors[group] || '#6366f1';
        
        const item = document.createElement('div');
        item.className = 'group-item';
        
        // 移動ボタンを追加
        const positionControls = `
            <div class="category-position-controls">
                <button class="position-btn move-group-up-btn" data-group="${group}" title="上へ移動">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="18 15 12 9 6 15"></polyline>
                    </svg>
                </button>
                <button class="position-btn move-group-down-btn" data-group="${group}" title="下へ移動">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
            </div>
        `;
        
        item.innerHTML = `
            <div class="group-name">
                <span class="group-color" style="background-color: ${color}"></span>
                ${group}
            </div>
            <div class="group-actions">
                ${positionControls}
                <button class="icon-btn edit-group-btn" data-group="${group}" title="編集">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                </button>
                <button class="icon-btn change-color-btn" data-group="${group}" data-color="${color}" title="色変更">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <circle cx="12" cy="12" r="4"></circle>
                    </svg>
                </button>
                <button class="icon-btn delete-group-btn" data-group="${group}" title="削除">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                </button>
            </div>
        `;
        
        groupList.appendChild(item);
    });
    
    // グループ編集イベント
    document.querySelectorAll('.edit-group-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const group = this.dataset.group;
            const newName = prompt('グループ名を編集', group);
            
            if (newName && newName !== group) {
                editGroup(group, newName);
            }
        });
    });
    
    // 色変更イベント
    document.querySelectorAll('.change-color-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const group = this.dataset.group;
            const currentColor = this.dataset.color;
            
            // カラーピッカーを表示
            const colorPicker = document.createElement('input');
            colorPicker.type = 'color';
            colorPicker.value = currentColor;
            colorPicker.style.opacity = '0';
            colorPicker.style.position = 'absolute';
            colorPicker.style.pointerEvents = 'none';
            
            document.body.appendChild(colorPicker);
            
            // カラーピッカーを開く
            colorPicker.addEventListener('input', function() {
                // 色を更新
                updateGroupColor(group, this.value);
            });
            
            colorPicker.click();
            
            // クリーンアップ
            setTimeout(() => {
                document.body.removeChild(colorPicker);
            }, 1000);
        });
    });
    
    // グループ削除イベント
    document.querySelectorAll('.delete-group-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const group = this.dataset.group;
            if (confirm(`グループ「${group}」を削除しますか？`)) {
                deleteGroup(group);
            }
        });
    });
    
    // グループ移動イベント
    document.querySelectorAll('.move-group-up-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const group = this.dataset.group;
            moveGroup(group, 'up');
        });
    });
    
    document.querySelectorAll('.move-group-down-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const group = this.dataset.group;
            moveGroup(group, 'down');
        });
    });
}

// グループの色を更新する関数
function updateGroupColor(groupName, color) {
    const groupColors = getGroupColors();
    groupColors[groupName] = color;
    saveGroupColors(groupColors);
    
    // グループリストを再レンダリング
    renderGroupList();
    
    // リンクを再レンダリング（グループバッジの色を更新）
    const activeCategory = document.querySelector('.category-filter.active').dataset.category;
    const activeGroup = groupFilter.value;
    renderLinks(searchInput.value, activeCategory, activeGroup);
    
    showToast(`グループ「${groupName}」の色を変更しました`);
}

// カテゴリーを追加する関数の修正
function addCategory(name) {
    if (!name) return;
    
    const categories = getCategories();
    if (categories.includes(name)) {
        showToast(`カテゴリー「${name}」は既に存在します`);
        return;
    }
    
    // ここで既にカテゴリー配列に追加している
    categories.push(name);
    saveCategories(categories);

    // 順序リストを取得して、存在チェックを追加
    const categoryOrder = getCategoryOrder();
    if (!categoryOrder.includes(name)) {  // この行を追加
        categoryOrder.push(name);
        saveCategoryOrder(categoryOrder);
    }
    
    // デフォルトアイコンを設定（既存アイコンが設定されていない場合のみ）
    const categoryIcons = getCategoryIcons();
    if (!categoryIcons[name]) {  // この行を追加
        categoryIcons[name] = 'info'; // デフォルトは情報アイコン
        saveCategoryIcons(categoryIcons);
    }
    
    renderCategoryFilters();
    renderCategoryList();
    
    // 入力フィールドをクリア
    document.getElementById('newCategoryName').value = '';
    
    showToast(`カテゴリー「${name}」を追加しました`);
}

// グループを追加する関数
function addGroup(name, color = '#6366f1') {
    if (!name) return;
    
    const groups = getGroups();
    if (groups.includes(name)) {
        showToast(`グループ「${name}」は既に存在します`);
        return;
    }
    
    groups.push(name);
    saveGroups(groups);

    // 順序リストにも追加
    const groupOrder = getGroupOrder();
    groupOrder.push(name);
    saveGroupOrder(groupOrder);
    
    // 色を設定
    const groupColors = getGroupColors();
    groupColors[name] = color;
    saveGroupColors(groupColors);
    
    renderGroupFilter();
    renderGroupList();
    showToast(`グループ「${name}」を追加しました`);
}

// カテゴリーを編集する関数
function editCategory(oldName, newName) {
    if (!newName) return;
    
    const categories = getCategories();
    if (categories.includes(newName)) {
        showToast(`カテゴリー「${newName}」は既に存在します`);
        return;
    }
    
    const index = categories.indexOf(oldName);
    if (index !== -1) {
        categories[index] = newName;
        saveCategories(categories);
        
        // 順序リストも更新
        const categoryOrder = getCategoryOrder();
        const orderIndex = categoryOrder.indexOf(oldName);
        if (orderIndex !== -1) {
            categoryOrder[orderIndex] = newName;
            saveCategoryOrder(categoryOrder);
        }
        
        // アイコン設定も更新
        const categoryIcons = getCategoryIcons();
        if (categoryIcons[oldName]) {
            categoryIcons[newName] = categoryIcons[oldName];
            delete categoryIcons[oldName];
            saveCategoryIcons(categoryIcons);
        }
        
        // このカテゴリーに属するリンクも更新
        const links = getLinks();
        links.forEach(link => {
            if (link.category === oldName) {
                link.category = newName;
            }
        });
        saveLinks(links);
        
        renderCategoryFilters();
        renderCategoryList();
        renderLinks(searchInput.value, document.querySelector('.category-filter.active').dataset.category, groupFilter.value);
        showToast(`カテゴリー「${oldName}」を「${newName}」に変更しました`);
    }
}

// グループを編集する関数
function editGroup(oldName, newName) {
    if (!newName) return;
    
    const groups = getGroups();
    if (groups.includes(newName)) {
        showToast(`グループ「${newName}」は既に存在します`);
        return;
    }
    
    const index = groups.indexOf(oldName);
    if (index !== -1) {
        groups[index] = newName;
        saveGroups(groups);
        
        // 順序リストも更新
        const groupOrder = getGroupOrder();
        const orderIndex = groupOrder.indexOf(oldName);
        if (orderIndex !== -1) {
            groupOrder[orderIndex] = newName;
            saveGroupOrder(groupOrder);
        }
        
        // 色設定も更新
        const groupColors = getGroupColors();
        if (groupColors[oldName]) {
            groupColors[newName] = groupColors[oldName];
            delete groupColors[oldName];
            saveGroupColors(groupColors);
        }
        
        // このグループに属するリンクも更新
        const links = getLinks();
        links.forEach(link => {
            if (link.group === oldName) {
                link.group = newName;
            }
        });
        saveLinks(links);
        
        renderGroupFilter();
        renderGroupList();
        renderLinks(searchInput.value, document.querySelector('.category-filter.active').dataset.category, groupFilter.value);
        showToast(`グループ「${oldName}」を「${newName}」に変更しました`);
    }
}

// カテゴリーを削除する関数
function deleteCategory(name) {
    const categories = getCategories();
    const index = categories.indexOf(name);
    
    if (index !== -1) {
        categories.splice(index, 1);
        saveCategories(categories);
        
        // 順序リストからも削除
        const categoryOrder = getCategoryOrder();
        const orderIndex = categoryOrder.indexOf(name);
        if (orderIndex !== -1) {
            categoryOrder.splice(orderIndex, 1);
            saveCategoryOrder(categoryOrder);
        }
        
        // アイコン設定も削除
        const categoryIcons = getCategoryIcons();
        if (categoryIcons[name]) {
            delete categoryIcons[name];
            saveCategoryIcons(categoryIcons);
        }
        
        // このカテゴリーに属するリンクはカテゴリーなしに移動
        const links = getLinks();
        links.forEach(link => {
            if (link.category === name) {
                if (categories.length > 0) {
                    link.category = categories[0]; // 最初のカテゴリーに移動
                } else {
                    delete link.category; // カテゴリーがなければcategoryプロパティ自体を削除
                }
            }
        });
        saveLinks(links);
        
        renderCategoryFilters();
        renderCategoryList();
        renderLinks(searchInput.value, document.querySelector('.category-filter.active').dataset.category, groupFilter.value);
        showToast(`カテゴリー「${name}」を削除しました`);
    }
}

// グループを削除する関数
function deleteGroup(name) {
    const groups = getGroups();
    const index = groups.indexOf(name);
    
    if (index !== -1) {
        groups.splice(index, 1);
        saveGroups(groups);
        
        // 順序リストからも削除
        const groupOrder = getGroupOrder();
        const orderIndex = groupOrder.indexOf(name);
        if (orderIndex !== -1) {
            groupOrder.splice(orderIndex, 1);
            saveGroupOrder(groupOrder);
        }
        
        // 色設定も削除
        const groupColors = getGroupColors();
        if (groupColors[name]) {
            delete groupColors[name];
            saveGroupColors(groupColors);
        }
        
        // このグループに属するリンクはグループなしに設定
        const links = getLinks();
        links.forEach(link => {
            if (link.group === name) {
                link.group = '';
            }
        });
        saveLinks(links);
        
        renderGroupFilter();
        renderGroupList();
        renderLinks(searchInput.value, document.querySelector('.category-filter.active').dataset.category, groupFilter.value);
        showToast(`グループ「${name}」を削除しました`);
    }
}

// リンクカード要素を作成する関数
function createLinkCard(link, index) {
    const card = document.createElement('div');
    card.className = 'link-card';
    card.dataset.id = link.id;
    card.dataset.category = link.category || '';
    card.dataset.group = link.group || '';
    card.dataset.order = link.order || index;
    card.style.animationDelay = `${index * 0.05}s`;
    
    const iconHtml = getIconFromUrl(link.url, link.category);
    
    // グループバッジを生成
    let groupBadgeHtml = '';
    if (link.group) {
        const groupColor = getColorForGroup(link.group);
        groupBadgeHtml = `
            <div class="group-badge" style="background-color: ${groupColor}">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                ${link.group}
            </div>
        `;
    }
    
    card.innerHTML = `
        ${groupBadgeHtml}
        <div class="position-controls">
            <button class="position-btn move-up-btn" title="上へ移動">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="18 15 12 9 6 15"></polyline>
                </svg>
            </button>
            <button class="position-btn move-down-btn" title="下へ移動">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
        </div>
        <div class="link-icon">${iconHtml}</div>
        <h3 class="link-title">${link.title}</h3>
        <p class="link-description">${link.description || '説明なし'}</p>
        <div class="link-actions">
            <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="visit-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                </svg>
                開く
            </a>
            <div class="link-actions-group">
                <button class="icon-btn edit-btn" data-id="${link.id}" title="編集">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                </button>
                <button class="icon-btn delete-btn" data-id="${link.id}" title="削除">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                </button>
            </div>
        </div>
    `;
    
    // 編集ボタンにイベントリスナーを追加
    const editBtn = card.querySelector('.edit-btn');
    editBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const linkToEdit = getLinks().find(l => l.id === link.id);
        if (linkToEdit) {
            openLinkModal('edit', linkToEdit);
        }
    });
    
    // 削除ボタンにイベントリスナーを追加
    const deleteBtn = card.querySelector('.delete-btn');
    deleteBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        deleteLink(link.id);
    });
    
    // 上移動ボタンにイベントリスナーを追加
    const moveUpBtn = card.querySelector('.move-up-btn');
    moveUpBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        moveCard(link.id, 'up');
    });
    
    // 下移動ボタンにイベントリスナーを追加
    const moveDownBtn = card.querySelector('.move-down-btn');
    moveDownBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        moveCard(link.id, 'down');
    });
    
    // ツールチップ機能を追加
    const visitBtn = card.querySelector('.visit-btn');
    addTooltip(visitBtn, link.url);
    
    // 配置編集モード用のクリックイベント
    card.addEventListener('click', () => {
        if (isEditMode) {
            handleCardSelection(card);
        }
    });
    
    return card;
}

// リンクカードを作成して表示する関数
function renderLinks(searchTerm = '', category = 'all') {
    let links = getLinks();
    
    // リンクの順序をソート
    links.sort((a, b) => (a.order || 0) - (b.order || 0));
    
    // 検索条件とカテゴリーでフィルタリングしたリンクを取得
    const filteredLinks = getFilteredLinks(links, searchTerm, category);
    
    // コンテナをクリア
    linksContainer.innerHTML = '';
    
    // ローディング表示は初期読み込み時には表示しない
    loadingIndicator.style.display = 'none';
    
    // 空の状態を処理
    if (filteredLinks.length === 0) {
        emptyState.style.display = 'flex';
    } else {
        emptyState.style.display = 'none';
        
        // 各リンクカードを作成して追加
        filteredLinks.forEach((link, index) => {
            const cardElement = createLinkCard(link, index);
            linksContainer.appendChild(cardElement);
        });
    }
}

// ツールチップ機能
function addTooltip(element, text) {
    const tooltip = document.createElement('div');
    tooltip.className = 'tooltip';
    tooltip.textContent = text;
    document.body.appendChild(tooltip);
    
    function positionTooltip(e) {
        const rect = element.getBoundingClientRect();
        tooltip.style.left = rect.left + 'px';
        tooltip.style.top = (rect.top - tooltip.offsetHeight - 10) + 'px';
        tooltip.style.opacity = '1';
        tooltip.style.transform = 'translateY(0)';
    }
    
    function hideTooltip() {
        tooltip.style.opacity = '0';
        tooltip.style.transform = 'translateY(5px)';
    }
    
    element.addEventListener('mouseenter', positionTooltip);
    element.addEventListener('mouseleave', hideTooltip);
    
    return tooltip;
}

// リンクを追加/更新する関数
function saveLink(formData) {
    const links = getLinks();
    const { id, title, url, description, category } = formData;
    
    if (id) {
        // 既存リンクの更新
        const index = links.findIndex(link => link.id === id);
        if (index !== -1) {
            links[index] = {
                ...links[index],
                title,
                url,
                description,
                category,
                // グループは空文字列に固定
                group: ''
            };
            saveLinks(links);
            showToast('リンクを更新しました');
        }
    } else {
        // 新規リンク追加
        const newLink = {
            id: 'link-' + Date.now(),
            title,
            url,
            description,
            category,
            // グループは空文字列に固定
            group: '',
            order: links.length
        };
        links.push(newLink);
        saveLinks(links);
        showToast('リンクを追加しました');
    }
    
    // 現在のフィルター状態を維持して再レンダリング
    const activeCategory = document.querySelector('.category-filter.active').dataset.category;
    renderLinks(searchInput.value, activeCategory, 'all');
}

// リンクを削除する関数
function deleteLink(id) {
    const card = document.querySelector(`.link-card[data-id="${id}"]`);
    
    // 削除アニメーション
    card.style.transform = 'scale(0.9)';
    card.style.opacity = '0';
    
    setTimeout(() => {
        const links = getLinks().filter(link => link.id !== id);
        
        // 順序の再割り当て
        links.forEach((link, index) => {
            link.order = index;
        });
        
        saveLinks(links);
        
        // 現在のフィルター状態を維持して再レンダリング
        const activeCategory = document.querySelector('.category-filter.active').dataset.category;
        const activeGroup = groupFilter.value;
        renderLinks(searchInput.value, activeCategory, activeGroup);
        
        showToast('リンクを削除しました');
    }, 300);
}

// ローカルストレージのデータをリセットする関数
function resetData() {
    localStorage.clear();
    showToast('すべてのデータをリセットしました');
    setTimeout(() => {
        window.location.reload();
    }, 1500);
}

// CSV形式のデータをインポートする関数
function importFromCSV(csvData) {
    const lines = csvData.split('\n');
    const links = getLinks();
    const existingUrls = new Set(links.map(link => link.url));
    let importCount = 0;
    let skipCount = 0;
    
    const importToSelectedCategory = importToCategory.checked;
    const selectedCategory = importCategory.value;
    
    lines.forEach(line => {
        if (!line.trim()) return; // 空行をスキップ
        
        // CSVフィールドを解析（簡易的な実装）
        const fields = line.split(',').map(field => field.trim());
        if (fields.length < 2) return; // 少なくともタイトルとURLが必要
        
        const title = fields[0];
        const url = fields[1];
        
        // URLが既に存在する場合はスキップ（オプション）
        if (skipDuplicates.checked && existingUrls.has(url)) {
            skipCount++;
            return;
        }
        
        // 新しいリンクの作成
        const newLink = {
            id: 'link-' + Date.now() + '-' + importCount,
            title: title,
            url: url,
            description: fields[2] || '',
            category: importToSelectedCategory ? selectedCategory : (fields[3] || 'ツール'),
            group: '',  // グループは常に空文字列
            order: links.length + importCount
        };
        
        links.push(newLink);
        existingUrls.add(url);
        importCount++;
    });
    
    saveLinks(links);
    showToast(`${importCount}件のリンクをインポートしました（${skipCount}件をスキップ）`);
    
    // 現在のフィルター状態を維持して再レンダリング
    const activeCategory = document.querySelector('.category-filter.active').dataset.category;
    renderLinks(searchInput.value, activeCategory, 'all');
}

// ブックマークHTMLからリンクをインポートする関数
function importFromBookmarkHTML(html) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');
    const links = getLinks();
    const existingUrls = new Set(links.map(link => link.url));
    let importCount = 0;
    let skipCount = 0;
    
    const importToSelectedCategory = importToCategory.checked;
    const selectedCategory = importCategory.value;
    
    // すべてのアンカータグを検索
    const anchors = doc.querySelectorAll('a');
    
    anchors.forEach(anchor => {
        const title = anchor.textContent.trim();
        const url = anchor.getAttribute('href');
        
        if (!url || !title) return; // タイトルまたはURLがない場合はスキップ
        
        // URLが既に存在する場合はスキップ（オプション）
        if (skipDuplicates.checked && existingUrls.has(url)) {
            skipCount++;
            return;
        }
        
        // 新しいリンクの作成
        const newLink = {
            id: 'link-' + Date.now() + '-' + importCount,
            title: title,
            url: url,
            description: anchor.getAttribute('description') || '',
            category: importToSelectedCategory ? selectedCategory : 'ブックマーク',
            group: '',  // グループは常に空文字列
            order: links.length + importCount
        };
        
        links.push(newLink);
        existingUrls.add(url);
        importCount++;
    });
    
    saveLinks(links);
    showToast(`${importCount}件のリンクをインポートしました（${skipCount}件をスキップ）`);
    
    // 現在のフィルター状態を維持して再レンダリング
    const activeCategory = document.querySelector('.category-filter.active').dataset.category;
    renderLinks(searchInput.value, activeCategory, 'all');
}
// テキスト形式のリンクをインポートする関数
function importFromText(text) {
    const lines = text.split('\n');
    const links = getLinks();
    const existingUrls = new Set(links.map(link => link.url));
    let importCount = 0;
    let skipCount = 0;
    
    const importToSelectedCategory = importToCategory.checked;
    const selectedCategory = importCategory.value;
    
    lines.forEach(line => {
        if (!line.trim()) return; // 空行をスキップ
        
        // 簡易的な解析（タイトル,URL）
        const parts = line.split(',');
        if (parts.length < 2) return;
        
        const title = parts[0].trim();
        const url = parts[1].trim();
        
        // URLが既に存在する場合はスキップ（オプション）
        if (skipDuplicates.checked && existingUrls.has(url)) {
            skipCount++;
            return;
        }
        
        // 新しいリンクの作成
        const newLink = {
            id: 'link-' + Date.now() + '-' + importCount,
            title: title,
            url: url,
            description: '',
            category: importToSelectedCategory ? selectedCategory : 'ツール',
            group: '',  // グループは常に空文字列
            order: links.length + importCount
        };
        
        links.push(newLink);
        existingUrls.add(url);
        importCount++;
    });
    
    saveLinks(links);
    showToast(`${importCount}件のリンクをインポートしました（${skipCount}件をスキップ）`);
    
    // 現在のフィルター状態を維持して再レンダリング
    const activeCategory = document.querySelector('.category-filter.active').dataset.category;
    renderLinks(searchInput.value, activeCategory, 'all');
}
// ユーティリティ：デバウンス関数
function debounce(func, wait) {
    let timeout;
    return function(...args) {
        const context = this;
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(context, args), wait);
    };
}

// ローカルストレージの全データを取得する関数
function getAllLocalStorageData() {
    const data = {};
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        try {
            // JSONデータを保持
            const value = localStorage.getItem(key);
            data[key] = value;
        } catch (e) {
            console.error(`Error getting data for key ${key}:`, e);
        }
    }
    return data;
}

// データをエクスポートする関数
function exportData() {
    try {
        const data = getAllLocalStorageData();
        const jsonData = JSON.stringify(data, null, 2);
        
        // データをファイルとしてダウンロード
        const blob = new Blob([jsonData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        
        // 現在の日時を含めたファイル名を生成
        const date = new Date();
        const dateStr = date.toISOString().replace(/:/g, '-').split('.')[0]; // 日時フォーマット
        a.download = `portal-backup-${dateStr}.json`;
        
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showToast('データを正常にエクスポートしました');
    } catch (e) {
        console.error('Export error:', e);
        showToast('エクスポート中にエラーが発生しました');
    }
}

// データをインポートする関数
function importData(jsonData, merge = true) {
    try {
        const data = JSON.parse(jsonData);
        
        if (!merge) {
            // 既存データをクリア（置き換えモード）
            localStorage.clear();
        }
        
        // データをローカルストレージに保存
        for (const [key, value] of Object.entries(data)) {
            localStorage.setItem(key, value);
        }
        
        showToast('データを正常にインポートしました');
        
        // ページを再読み込み
        setTimeout(() => {
            window.location.reload();
        }, 1500);
    } catch (e) {
        console.error('Import error:', e);
        showToast('インポート中にエラーが発生しました。データ形式を確認してください');
    }
}

// 時計とカレンダーの機能
function initClockAndCalendar() {
    // 曜日の配列（日本語）
    const weekdays = ['日', '月', '火', '水', '木', '金', '土'];
    
    // 現在時刻と日付を表示する関数
    function updateClock() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const weekday = weekdays[now.getDay()];
        
        // 時刻を更新
        const timeString = `${hours}:${minutes}:${seconds}`;
        document.getElementById('timeDisplay').textContent = timeString;
        
        // 日付を更新
        const dateString = `${year}年${month}月${day}日 (${weekday})`;
        document.getElementById('dateDisplay').textContent = dateString;
    }
    
    // 初回実行
    updateClock();
    
    // 1秒ごとに時刻を更新
    setInterval(updateClock, 1000);
    
    // カレンダー機能のコード
    const calendarPopup = document.getElementById('calendarPopup');
    const currentTime = document.getElementById('currentTime');
    
    // 時計をクリックするとカレンダーを表示/非表示
    currentTime.addEventListener('click', function() {
        calendarPopup.classList.toggle('active');
    });
    
    // ページ内の任意の場所をクリックするとカレンダーを閉じる
    document.addEventListener('click', function(e) {
        if (!currentTime.contains(e.target) && !calendarPopup.contains(e.target)) {
            calendarPopup.classList.remove('active');
        }
    });
    
    // カレンダーの表示
    renderCalendar(new Date());
    
    // 前月・次月ボタンのイベント設定
    document.getElementById('prevMonth').addEventListener('click', function() {
        const currentDate = new Date(document.getElementById('currentMonth').dataset.date);
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
    });
    
    document.getElementById('nextMonth').addEventListener('click', function() {
        const currentDate = new Date(document.getElementById('currentMonth').dataset.date);
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
    });
}

// カレンダーをレンダリングする関数
function renderCalendar(date) {
    const year = date.getFullYear();
    const month = date.getMonth();
    
    // 月の最初の日と最後の日
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    
    // 月の表示を更新
    const monthElement = document.getElementById('currentMonth');
    monthElement.textContent = `${year}年${month + 1}月`;
    monthElement.dataset.date = date.toISOString();
    
    // 日付グリッドをクリア - カレンダーグリッドを取得して、曜日ヘッダー以外をクリア
    const calendarGrid = document.querySelector('.calendar-grid');
    // 曜日ヘッダーを保持する
    const weekdayHeaders = Array.from(calendarGrid.querySelectorAll('.weekday'));
    calendarGrid.innerHTML = '';
    
    // 曜日ヘッダーを再追加
    weekdayHeaders.forEach(header => {
        calendarGrid.appendChild(header);
    });
    
    // 前月の日を表示
    const firstDayOfWeek = firstDay.getDay(); // 0:日曜日, 1:月曜日, ...
    const prevMonthLastDay = new Date(year, month, 0).getDate();
    
    for (let i = 0; i < firstDayOfWeek; i++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'date other-month';
        dayElement.textContent = prevMonthLastDay - firstDayOfWeek + i + 1;
        calendarGrid.appendChild(dayElement);
    }
    
    // 当月の日を表示
    const today = new Date();
    for (let i = 1; i <= lastDay.getDate(); i++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'date';
        
        // 土日の場合はweekendクラスを追加
        const dayOfWeek = new Date(year, month, i).getDay();
        if (dayOfWeek === 0 || dayOfWeek === 6) {
            dayElement.classList.add('weekend');
        }
        
        // 今日の日付には特別なクラスを追加
        if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === i) {
            dayElement.classList.add('today');
        }
        
        dayElement.textContent = i;
        calendarGrid.appendChild(dayElement);
    }
    
    // 翌月の日を表示（最大42マスになるまで）
    const totalDaysDisplayed = firstDayOfWeek + lastDay.getDate();
    const remainingCells = 42 - totalDaysDisplayed;
    
    for (let i = 1; i <= remainingCells; i++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'date other-month';
        dayElement.textContent = i;
        calendarGrid.appendChild(dayElement);
    }
}

// 初期化関数に以下を追加
function init() {
    // テーマ設定を適用
    applyThemeSettings(getThemeSettings());
    
    // カテゴリーフィルターを生成
    renderCategoryFilters();
    
    // グループ関連のUIを非表示
    document.querySelector('.group-controls').style.display = 'none';
    
    // リンク追加/編集フォームからグループ選択を非表示
    document.querySelector('.form-group:has(#linkGroup)').style.display = 'none';
    
    // リンクを表示
    renderLinks();
    
    // 時計とカレンダーを初期化
    initClockAndCalendar();
}

// イベントリスナー設定

// テーマ切り替え
themeToggle.addEventListener('click', toggleTheme);

// テーマ設定ボタン
themeSettingsBtn.addEventListener('click', openThemeSettingsModal);
closeThemeSettingsBtn.addEventListener('click', closeThemeSettingsModal);

// テーマ設定フォーム
darkModeBtn.addEventListener('click', () => {
    const settings = getThemeSettings();
    settings.mode = 'dark';
    saveThemeSettings(settings);
    applyThemeSettings(settings);
    // フォームを更新して背景グラデーション設定を無効化
    updateThemeSettingsForm(settings);
});

lightModeBtn.addEventListener('click', () => {
    const settings = getThemeSettings();
    settings.mode = 'light';
    saveThemeSettings(settings);
    applyThemeSettings(settings);
    // フォームを更新して背景グラデーション設定を有効化
    updateThemeSettingsForm(settings);
});

autoModeBtn.addEventListener('click', () => {
    const settings = getThemeSettings();
    settings.mode = 'auto';
    saveThemeSettings(settings);
    applyThemeSettings(settings);
    // フォームを更新
    updateThemeSettingsForm(settings);
});

// スライダーのリアルタイム更新
blurStrength.addEventListener('input', () => {
    blurValue.textContent = `${blurStrength.value}px`;
});

cardOpacity.addEventListener('input', () => {
    opacityValue.textContent = `0.${cardOpacity.value}`;
});

animationSpeed.addEventListener('input', () => {
    if (animationSpeed.value <= 5) {
        speedValue.textContent = '遅い';
    } else if (animationSpeed.value <= 10) {
        speedValue.textContent = '普通';
    } else {
        speedValue.textContent = '速い';
    }
});

// プリセットボタン
presetBtns.forEach(btn => {
    btn.addEventListener('click', () => {
        const preset = btn.dataset.preset;
        if (themePresets[preset]) {
            updateThemeSettingsForm(themePresets[preset]);
        }
    });
});

// テーマ設定の適用・リセット
applyThemeBtn.addEventListener('click', () => {
    const settings = {
        mode: document.querySelector('.theme-mode-btn.active')?.id === 'lightModeBtn' ? 'light' : 
              document.querySelector('.theme-mode-btn.active')?.id === 'darkModeBtn' ? 'dark' : 'auto',
        primaryColor: primaryColor.value,
        bgGradient1: bgGradient1.value,
        bgGradient2: bgGradient2.value,
        textColor: textColor.value,
        blurStrength: parseInt(blurStrength.value),
        cardOpacity: parseInt(cardOpacity.value),
        animationSpeed: parseInt(animationSpeed.value),
        fontSize: fontSize.value
    };
    
    saveThemeSettings(settings);
    applyThemeSettings(settings);
    closeThemeSettingsModal();
    showToast('テーマ設定を適用しました');
});

resetThemeBtn.addEventListener('click', () => {
    saveThemeSettings(defaultThemeSettings);
    applyThemeSettings(defaultThemeSettings);
    updateThemeSettingsForm(defaultThemeSettings);
    showToast('テーマ設定をリセットしました');
});

// 一括インポートモーダル操作
bulkImportBtn.addEventListener('click', openBulkImportModal);
closeBulkImportBtn.addEventListener('click', closeBulkImportModal);
cancelImportBtn.addEventListener('click', closeBulkImportModal);

// タブ切り替え
importTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        const target = tab.dataset.tab;
        
        // タブの切り替え
        importTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // コンテンツの切り替え
        importContents.forEach(content => {
            content.classList.remove('active');
            if (content.id === `${target}Import`) {
                content.classList.add('active');
            }
        });
    });
});

// CSVファイル選択時のプレビュー
csvFile.addEventListener('change', () => {
    const file = csvFile.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const content = e.target.result;
            // プレビューに先頭10行を表示
            const lines = content.split('\n').slice(0, 10);
            csvPreview.textContent = lines.join('\n');
        };
        reader.readAsText(file);
    }
});

// ブックマークファイル選択時のプレビュー
bookmarkFile.addEventListener('change', () => {
    const file = bookmarkFile.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const content = e.target.result;
            const parser = new DOMParser();
            const doc = parser.parseFromString(content, 'text/html');
            
            // 先頭10個のリンクを表示
            const anchors = Array.from(doc.querySelectorAll('a')).slice(0, 10);
            let preview = '';
            
            anchors.forEach(anchor => {
                preview += `${anchor.textContent} - ${anchor.href}\n`;
            });
            
            bookmarkPreview.textContent = preview;
        };
        reader.readAsText(file);
    }
});

// インポート処理
processImportBtn.addEventListener('click', () => {
    // アクティブなタブを取得
    const activeTab = document.querySelector('.import-tab.active').dataset.tab;
    
    switch (activeTab) {
        case 'csv':
            const csvFileElement = document.getElementById('csvFile');
            if (csvFileElement.files.length > 0) {
                const file = csvFileElement.files[0];
                const reader = new FileReader();
                reader.onload = (e) => {
                    importFromCSV(e.target.result);
                    closeBulkImportModal();
                };
                reader.readAsText(file);
            } else {
                showToast('CSVファイルを選択してください');
            }
            break;
            
        case 'bookmark':
            const bookmarkFileElement = document.getElementById('bookmarkFile');
            if (bookmarkFileElement.files.length > 0) {
                const file = bookmarkFileElement.files[0];
                const reader = new FileReader();
                reader.onload = (e) => {
                    importFromBookmarkHTML(e.target.result);
                    closeBulkImportModal();
                };
                reader.readAsText(file);
            } else {
                showToast('ブックマークファイルを選択してください');
            }
            break;
            
        case 'text':
            const text = document.getElementById('importText').value;
            if (text.trim()) {
                importFromText(text);
                closeBulkImportModal();
            } else {
                showToast('インポートするテキストを入力してください');
            }
            break;
    }
});
// HTML内の group-controls 要素を非表示にする
document.querySelector('.group-controls').style.display = 'none';
// リンク追加ボタン
addLinkBtn.addEventListener('click', () => openLinkModal());

// 配置編集モードボタン
editModeBtn.addEventListener('click', toggleEditMode);

// リンクモーダルを閉じる
closeModalBtn.addEventListener('click', closeLinkModal);
linkModal.addEventListener('click', (e) => {
    if (e.target === linkModal) {
        closeLinkModal();
    }
});

// アイコンモーダルを閉じる
closeIconModalBtn.addEventListener('click', closeIconModal);
iconModal.addEventListener('click', (e) => {
    if (e.target === iconModal) {
        closeIconModal();
    }
});

// カテゴリー管理ボタン
manageCategoriesBtn.addEventListener('click', openCategoryModal);

// カテゴリーモーダルを閉じる
closeCategoryModalBtn.addEventListener('click', closeCategoryModal);
categoryModal.addEventListener('click', (e) => {
    if (e.target === categoryModal) {
        closeCategoryModal();
    }
});

// グループ管理ボタン
manageGroupsBtn.addEventListener('click', openGroupModal);

// グループモーダルを閉じる
closeGroupModalBtn.addEventListener('click', closeGroupModal);
groupModal.addEventListener('click', (e) => {
    if (e.target === groupModal) {
        closeGroupModal();
    }
});

// カテゴリー追加ボタン
addCategoryBtn.addEventListener('click', () => {
    const name = newCategoryName.value.trim();
    if (name) {
        addCategory(name);
        newCategoryName.value = '';
    }
});

// グループ追加ボタン
addGroupBtn.addEventListener('click', () => {
    const name = newGroupName.value.trim();
    const color = newGroupColor.value;
    if (name) {
        addGroup(name, color);
        newGroupName.value = '';
    }
});

// フォーム送信イベント
linkForm.addEventListener('submit', (e) => {
    e.preventDefault();
    
    const formData = {
        id: document.getElementById('linkId').value,
        title: document.getElementById('linkTitle').value.trim(),
        url: document.getElementById('linkUrl').value.trim(),
        description: document.getElementById('linkDescription').value.trim(),
        category: document.getElementById('linkCategory').value,
        group: document.getElementById('linkGroup').value
    };
    
    saveLink(formData);
    closeLinkModal();
});

// 検索機能
searchInput.addEventListener('input', debounce(function() {
    const activeCategory = document.querySelector('.category-filter.active').dataset.category;
    const activeGroup = groupFilter.value;
    renderLinks(this.value, activeCategory, activeGroup);
}, 300));

// カテゴリーフィルター
categoryFilters.addEventListener('click', (e) => {
    if (e.target.classList.contains('category-filter') || e.target.parentElement.classList.contains('category-filter')) {
        const filterBtn = e.target.classList.contains('category-filter') ? e.target : e.target.parentElement;
        const category = filterBtn.dataset.category;
        
        // アクティブクラスを切り替え
        document.querySelectorAll('.category-filter').forEach(btn => {
            btn.classList.remove('active');
        });
        filterBtn.classList.add('active');
        
        // フィルタリングして表示
        renderLinks(searchInput.value, category, groupFilter.value);
    }
});

// グループフィルター
groupFilter.addEventListener('change', () => {
    const activeCategory = document.querySelector('.category-filter.active').dataset.category;
    renderLinks(searchInput.value, activeCategory, groupFilter.value);
});

// キーボードイベント（Escキーでモーダルを閉じる）
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        if (linkModal.classList.contains('active')) {
            closeLinkModal();
        }
        if (categoryModal.classList.contains('active')) {
            closeCategoryModal();
        }
        if (groupModal.classList.contains('active')) {
            closeGroupModal();
        }
        if (iconModal.classList.contains('active')) {
            closeIconModal();
        }
        if (themeSettingsModal.classList.contains('active')) {
            closeThemeSettingsModal();
        }
        if (bulkImportModal.classList.contains('active')) {
            closeBulkImportModal();
        }
        if (isEditMode) {
            toggleEditMode();
        }
    }
});

// エンターキーでカテゴリー追加
newCategoryName.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        e.preventDefault();
        const name = newCategoryName.value.trim();
        if (name) {
            addCategory(name);
            newCategoryName.value = '';
        }
    }
});

// エンターキーでグループ追加
newGroupName.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        e.preventDefault();
        const name = newGroupName.value.trim();
        const color = newGroupColor.value;
        if (name) {
            addGroup(name, color);
            newGroupName.value = '';
        }
    }
});

// リセット関連
resetDataBtn.addEventListener('click', () => {
    resetModal.classList.add('active');
});

closeResetModalBtn.addEventListener('click', () => {
    resetModal.classList.remove('active');
});

cancelResetBtn.addEventListener('click', () => {
    resetModal.classList.remove('active');
});

confirmResetBtn.addEventListener('click', () => {
    resetData();
    resetModal.classList.remove('active');
});

// データエクスポート/インポート関連
exportDataBtn.addEventListener('click', exportData);

importDataBtn.addEventListener('click', () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = e.target.result;
                    importData(data, true);
                } catch (err) {
                    showToast('インポート中にエラーが発生しました');
                    console.error(err);
                }
            };
            reader.readAsText(file);
        }
    });
    
    input.click();
});

// 初期化
document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
